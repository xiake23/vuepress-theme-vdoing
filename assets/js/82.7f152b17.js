(window.webpackJsonp=window.webpackJsonp||[]).push([[82],{409:function(s,n,a){"use strict";a.r(n);var e=a(4),t=Object(e.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"nginx的https证书自动续期"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx的https证书自动续期"}},[s._v("#")]),s._v(" nginx的https证书自动续期")]),s._v(" "),n("p",[s._v("本文讲述 nginx 的 https 证书如何自动续期。顺便讲述如何手动续期，如何方便地管理所有域名证书。有很多实现方案，包括收费方案和免费方案，本文采用的是 acme.sh 方案。")]),s._v(" "),n("h2",{attrs:{id:"_1-安装-acme-客户端"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装-acme-客户端"}},[s._v("#")]),s._v(" 1. 安装 acme 客户端")]),s._v(" "),n("blockquote",[n("p",[s._v("需要将系统环境切换到root用户下执行，否则安装证书时可能会失败。")])]),s._v(" "),n("p",[s._v("acme 客户端实际上就是个 shell 脚本，执行如下命令完成安装(若出现网络错误，反复重复直到成功即可)。\ncurl https://get.acme.sh | sh")]),s._v(" "),n("blockquote",[n("p",[s._v("若访问如上官方脚本较慢，可以使用如下国内镜像地址"),n("code",[s._v("curl https://gitcode.net/cert/cn-acme.sh/-/raw/master/install.sh?inline=false | sh")])])]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("[root@iZ2ze7011et12xez70sp3dZ nginx]# curl  https://get.acme.sh | sh\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n100   775    0   775    0     0    145      0 --:--:--  0:00:05 --:--:--   160\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n100  201k  100  201k    0     0  18804      0  0:00:10  0:00:10 --:--:-- 19012\n[2020年 11月 02日 星期一 16:12:52 CST] Installing from online archive.\n[2020年 11月 02日 星期一 16:12:52 CST] Downloading https://github.com/acmesh-official/acme.sh/archive/master.tar.gz\n[2020年 11月 02日 星期一 16:13:10 CST] Extracting master.tar.gz\n[2020年 11月 02日 星期一 16:13:10 CST] It is recommended to install socat first.\n[2020年 11月 02日 星期一 16:13:10 CST] We use socat for standalone server if you use standalone mode.\n[2020年 11月 02日 星期一 16:13:10 CST] If you don't use standalone mode, just ignore this warning.\n[2020年 11月 02日 星期一 16:13:10 CST] Installing to /root/.acme.sh\n[2020年 11月 02日 星期一 16:13:10 CST] Installed to /root/.acme.sh/acme.sh\n[2020年 11月 02日 星期一 16:13:10 CST] Installing alias to '/root/.bashrc'\n[2020年 11月 02日 星期一 16:13:10 CST] OK, Close and reopen your terminal to start using acme.sh\n[2020年 11月 02日 星期一 16:13:10 CST] Installing alias to '/root/.cshrc'\n[2020年 11月 02日 星期一 16:13:10 CST] Installing alias to '/root/.tcshrc'\n[2020年 11月 02日 星期一 16:13:10 CST] Installing cron job\n[2020年 11月 02日 星期一 16:13:10 CST] Good, bash is found, so change the shebang to use bash as preferred.\n[2020年 11月 02日 星期一 16:13:10 CST] OK\n[2020年 11月 02日 星期一 16:13:10 CST] Install success!\n[root@iZ2ze7011et12xez70sp3dZ nginx]#\n \n        Copied!\n    \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br")])]),n("blockquote",[n("p",[s._v("acme 依赖定时任务, 所以若系统没有安装 cron 服务，安装会失败，并提示您安装 cron 服务。")])]),s._v(" "),n("p",[s._v("如上的安装过程中，会:")]),s._v(" "),n("ul",[n("li",[s._v("自动创建目录~/.acme.sh/\n最终的 acme 客户端路径为~/.acme.sh/acme.sh\n执行~/.acme.sh/acme.sh -v, 查看客户端版本")])]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("[root@iZ2ze7011et12xez70sp3dZ nginx]# ~/.acme.sh/acme.sh -v\nhttps://github.com/acmesh-official/acme.sh\nv2.8.8\n[root@iZ2ze7011et12xez70sp3dZ nginx]#\n \n        Copied!\n    \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("ul",[n("li",[s._v("自动创建 alias 别名 acme.sh\n这样在执行脚本/root/.acme.sh/acme.sh 的时候就没必要填写完整路径，只需要执行 acme.sh 即可识别。")])]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("[root@iZ2ze7011et12xez70sp3dZ nginx]# alias\nalias acme.sh='/root/.acme.sh/acme.sh'\nalias cp='cp -i'\nalias egrep='egrep --color=auto'\nalias fgrep='fgrep --color=auto'\nalias grep='grep --color=auto'\nalias l.='ls -d .* --color=auto'\nalias ll='ls -l --color=auto'\nalias ls='ls --color=auto'\nalias mv='mv -i'\nalias rm='rm -i'\nalias which='alias | /usr/bin/which --tty-only --read-alias --show-dot --show-tilde'\n[root@iZ2ze7011et12xez70sp3dZ nginx]#\n \n        Copied!\n    \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])]),n("ul",[n("li",[s._v("自动创建 cronjob 定时任务, 每天定时自动检测所有的证书，如果快过期了，则会自动更新证书。\n执行"),n("strong",[s._v("crontab -l")]),s._v("，查看当前的定时任务列表，发现已经被自动增加了 acme 脚本的定时任务。")])]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('[root@iZ2ze7011et12xez70sp3dZ nginx]# crontab -l\n10 0 * * * "/root/.acme.sh"/acme.sh --cron --home "/root/.acme.sh" > /dev/null\n[root@iZ2ze7011et12xez70sp3dZ nginx]#\n \n        Copied!\n    \n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("h2",{attrs:{id:"_2-生成证书"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-生成证书"}},[s._v("#")]),s._v(" 2. 生成证书")]),s._v(" "),n("blockquote",[n("p",[s._v("证书的验证支持"),n("strong",[s._v("文件验证")]),s._v("或 "),n("strong",[s._v("dns 验证")]),s._v("，2 种方式采用其中一种即可。推荐采用 dns 验证，dns 验证的优势如下:")]),s._v(" "),n("ol",[n("li",[s._v("支持"),n("strong",[s._v("泛域名")]),s._v("证书的验证，但是"),n("strong",[s._v("文件验证")]),s._v("方式不支持"),n("strong",[s._v("泛域名")]),s._v("。")]),s._v(" "),n("li",[s._v("生成证书的操作在机器选择上更灵活，采用 dns 验证可以在任何机器上生成证书，但是采用文件验证就只能在域名所属服务器上生成证书(因为需要指定 nginx 发布根目录)。")])])]),s._v(" "),n("p",[n("strong",[s._v("注意:")]),s._v(" 无论采用哪种验证方式，在验证过程中会自动校验http域名是否有效。所以在进入该步骤的前提：您的域名可以通过http正常访问。")]),s._v(" "),n("h3",{attrs:{id:"_2-1-采用文件验证方式生成证书"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-采用文件验证方式生成证书"}},[s._v("#")]),s._v(" 2.1 采用"),n("strong",[s._v("文件验证")]),s._v("方式生成证书")]),s._v(" "),n("blockquote",[n("ol",[n("li",[s._v("采用"),n("strong",[s._v("文件验证方式")]),s._v("，会要求指定 web 根目录(acme 会自动在根目录下生成校验文件，然后通过域名访问校验文件，待证书验证完成后自动删除校验文件), 所以采用这种方式生成证书，一般需要在域名所在服务器上操作。")]),s._v(" "),n("li",[s._v("当然，执行本操作之前，您必须要确保该域名的http服务是可以正常访问的，因为验证过程中会使用http服务做验证。")])])]),s._v(" "),n("p",[s._v("执行如下命令 ~/.acme.sh/acme.sh --issue -d sofineday.com -d www.sofineday.com --webroot /static-file/blog/")]),s._v(" "),n("p",[n("strong",[s._v("参数的含义")]),s._v(":")]),s._v(" "),n("ul",[n("li",[s._v("--issue 是 acme.sh 脚本用来颁发证书的指令")]),s._v(" "),n("li",[s._v("-d 是--domain 的简称，其后面填写要续期的域名　　 acme.sh 支持多个域名共用同一个证书。\n如上命令生成的证书可同时用于 sofineday.com 和 www.sofineday.com。")]),s._v(" "),n("li",[s._v("-w 是--webroot 的简称，其后面须填写网站的根目录")])]),s._v(" "),n("p",[s._v("证书的实际生成过程如下:")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("root@ff939cf2d477:~# ~/.acme.sh/acme.sh  --issue  -d sofineday.com -d www.sofineday.com  --webroot /static-file/blog/\n[Mon Nov  2 09:34:37 UTC 2020] Using CA: https://acme-v02.api.letsencrypt.org/directory\n[Mon Nov  2 09:34:37 UTC 2020] Create account key ok.\n[Mon Nov  2 09:34:37 UTC 2020] Registering account: https://acme-v02.api.letsencrypt.org/directory\n[Mon Nov  2 09:34:39 UTC 2020] Registered\n[Mon Nov  2 09:34:39 UTC 2020] ACCOUNT_THUMBPRINT='J2XJiPj7rSQ4wODVXqtkbk5G3j3Jk6fVuw0j2EYNQr8'\n[Mon Nov  2 09:34:39 UTC 2020] Creating domain key\n[Mon Nov  2 09:34:39 UTC 2020] The domain key is here: /root/.acme.sh/sofineday.com/sofineday.com.key\n[Mon Nov  2 09:34:39 UTC 2020] Multi domain='DNS:sofineday.com,DNS:www.sofineday.com'\n[Mon Nov  2 09:34:40 UTC 2020] Getting domain auth token for each domain\n[Mon Nov  2 09:34:42 UTC 2020] Getting webroot for domain='sofineday.com'\n[Mon Nov  2 09:34:42 UTC 2020] Getting webroot for domain='www.sofineday.com'\n[Mon Nov  2 09:34:42 UTC 2020] Verifying: sofineday.com\n[Mon Nov  2 09:34:46 UTC 2020] Success\n[Mon Nov  2 09:34:46 UTC 2020] Verifying: www.sofineday.com\n[Mon Nov  2 09:34:50 UTC 2020] Pending\n[Mon Nov  2 09:34:53 UTC 2020] Pending\n[Mon Nov  2 09:34:57 UTC 2020] Pending\n[Mon Nov  2 09:35:00 UTC 2020] Pending\n[Mon Nov  2 09:35:03 UTC 2020] Pending\n[Mon Nov  2 09:35:07 UTC 2020] Pending\n[Mon Nov  2 09:35:10 UTC 2020] Pending\n[Mon Nov  2 09:35:12 UTC 2020] Pending\n[Mon Nov  2 09:35:15 UTC 2020] Pending\n[Mon Nov  2 09:35:18 UTC 2020] Pending\n[Mon Nov  2 09:35:21 UTC 2020] Pending\n[Mon Nov  2 09:35:24 UTC 2020] Pending\n[Mon Nov  2 09:35:27 UTC 2020] Pending\n[Mon Nov  2 09:35:30 UTC 2020] Pending\n[Mon Nov  2 09:35:32 UTC 2020] Pending\n[Mon Nov  2 09:35:35 UTC 2020] Success\n[Mon Nov  2 09:35:35 UTC 2020] Verify finished, start to sign.\n[Mon Nov  2 09:35:35 UTC 2020] Lets finalize the order.\n[Mon Nov  2 09:35:35 UTC 2020] Le_OrderFinalize='https://acme-v02.api.letsencrypt.org/acme/finalize/101076451/5997675384'\n[Mon Nov  2 09:35:36 UTC 2020] Downloading cert.\n[Mon Nov  2 09:35:36 UTC 2020] Le_LinkCert='https://acme-v02.api.letsencrypt.org/acme/cert/03a494dee4d14855d98ee65a117330602f7b'\n[Mon Nov  2 09:35:37 UTC 2020] Cert success.\n-----BEGIN CERTIFICATE-----\nMIIFZDCCBEygAwIBAgISA6SU3uTRSFXZjuZaEXMwYC97MA0GCSqGSIb3DQEBCwUA\nMEoxCzAJBgNVBAYTAlVTMRYwFAYDVQQKEw1MZXQncyBFbmNyeXB0MSMwIQYDVQQD\nExpMZXQncyBFbmNyeXB0IEF1dGhvcml0eSBYMzAeFw0yMDExMDIwODM1MzZaFw0y\nMTAxMzEwODM1MzZaMBgxFjAUBgNVBAMTDXNvZmluZWRheS5jb20wggEiMA0GCSqG\nSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCs+qLKD9XM+HZ9s9rFNnoN+6s/+NAgbD4A\nN7J2v2x19EGI68V+3p4PfJ9mC/hyPGOE/S09Is+h3gI1q5G9ePExbeImUnuhTfid\n9IOq9wf26EmqGj0Q2wXxP5QQf1kBQvweX/bel5xun9s8UdqDhOQnDEFhWRue4DHB\nFmdme7bl0dtSeuVM7AOTW9obUA2tz4h6zWPJY4vXTNcrnBst3CCzDOV3vivIO08z\nCqCapQGJleQTUM+OQNJ63vM63vA2YH1HmQx0h2HTrlCa4RcGaCudUO8p1uBjsi5N\nDa74KJHn8uAAKiGmNVxH3UfHptipj83tDl/gVYc8ImsxNcZkDQxZAgMBAAGjggJ0\nMIICcDAOBgNVHQ8BAf8EBAMCBaAwHQYDVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUF\nBwMCMAwGA1UdEwEB/wQCMAAwHQYDVR0OBBYEFIkCvyI57dP+OAsBKxndWaiV8IYQ\nMB8GA1UdIwQYMBaAFKhKamMEfd265tE5t6ZFZe/zqOyhMG8GCCsGAQUFBwEBBGMw\nYTAuBggrBgEFBQcwAYYiaHR0cDovL29jc3AuaW50LXgzLmxldHNlbmNyeXB0Lm9y\nZzAvBggrBgEFBQcwAoYjaHR0cDovL2NlcnQuaW50LXgzLmxldHNlbmNyeXB0Lm9y\nZy8wKwYDVR0RBCQwIoINc29maW5lZGF5LmNvbYIRd3d3LnNvZmluZWRheS5jb20w\nTAYDVR0gBEUwQzAIBgZngQwBAgEwNwYLKwYBBAGC3xMBAQEwKDAmBggrBgEFBQcC\nARYaaHR0cDovL2Nwcy5sZXRzZW5jcnlwdC5vcmcwggEDBgorBgEEAdZ5AgQCBIH0\nBIHxAO8AdgBvU3asMfAxGdiZAKRRFf93FRwR2QLBACkGjbIImjfZEwAAAXWIT9xE\nAAAEAwBHMEUCIC8k9sHNJLRPehn8rXklLCqPeH4xAfvhBF5SgLAmurIvAiEA0Csc\ntInX7h/WYncMNZArhZbzW0CWDGe5XaORBul36gAAdQD2XJQv0XcwIhRUGAgwlFaO\n400TGTO/3wwvIAvMTvFk4wAAAXWIT9wkAAAEAwBGMEQCIGQ6tViJ6Vy5ZUjTVLpg\njynJ+faFUtTU+O1izPw3cvldAiB0J3OxmXMr8h3KdqmDFhJxSqa+hYd7TV4SkkEH\nnt3BjzANBgkqhkiG9w0BAQsFAAOCAQEAbEoKns5FpQj5VgxoYlS+StnJS/db5wnc\n6hnZ3Rya0X8huuOeprtWpFEH3qMIrCmXSsWJLmUaaJKRIAhTqRPsoLXf/HxT4IW2\n9xrW435RKxisSfD4EJ4pybbNunHFms+FjJY+m5a3ojDjpErz8FVSeo88811yXNBz\nrfv5Pyt6s+0gFg0gO8wB6SWbsNPGA0HvhBmlo8mVOr2l2jNuH0uIRROKgZXvK/V1\n+bxpWUwAo5p/CSjFqWc7P/BPM3VQ/gHlkcpH37PWJDB+vzZkYzhuDc9hvxxR2/56\n86mbiykVKVvpK91imQy7sD0L1Rpv1kDNHhoBY5l3XBcr6gdv5STrpw==\n-----END CERTIFICATE-----\n[Mon Nov  2 09:35:37 UTC 2020] Your cert is in  /root/.acme.sh/sofineday.com/sofineday.com.cer\n[Mon Nov  2 09:35:37 UTC 2020] Your cert key is in  /root/.acme.sh/sofineday.com/sofineday.com.key\n[Mon Nov  2 09:35:37 UTC 2020] The intermediate CA cert is in  /root/.acme.sh/sofineday.com/ca.cer\n[Mon Nov  2 09:35:37 UTC 2020] And the full chain certs is there:  /root/.acme.sh/sofineday.com/fullchain.cer\nroot@ff939cf2d477:~#\n \n        Copied!\n    \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br")])]),n("p",[s._v("从以上生成过程可以看出，证书的生成位置为/root/.acme.sh/sofineday.com/目录。")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("root@ff939cf2d477:~# ls -l /root/.acme.sh/sofineday.com/\ntotal 28\n-rw-r--r-- 1 root root 1648 Nov  2 09:35 ca.cer\n-rw-r--r-- 1 root root 3579 Nov  2 09:35 fullchain.cer\n-rw-r--r-- 1 root root 1931 Nov  2 09:35 sofineday.com.cer\n-rw-r--r-- 1 root root  639 Nov  2 09:35 sofineday.com.conf\n-rw-r--r-- 1 root root  997 Nov  2 09:34 sofineday.com.csr\n-rw-r--r-- 1 root root  230 Nov  2 09:34 sofineday.com.csr.conf\n-rw-r--r-- 1 root root 1679 Nov  2 09:34 sofineday.com.key\nroot@ff939cf2d477:~#\n \n        Copied!\n    \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("h3",{attrs:{id:"_2-2-采用dns-验证方式生成证书"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-采用dns-验证方式生成证书"}},[s._v("#")]),s._v(" 2.2 采用"),n("strong",[s._v("dns 验证方式")]),s._v("生成证书")]),s._v(" "),n("h4",{attrs:{id:"_2-2-1-配置-dns-提供商的dns-api-key"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-1-配置-dns-提供商的dns-api-key"}},[s._v("#")]),s._v(" 2.2.1 配置 DNS 提供商的"),n("strong",[s._v("DNS API key")])]),s._v(" "),n("blockquote",[n("p",[s._v("本文以阿里云为例")])]),s._v(" "),n("ol",[n("li",[s._v("登录阿里云后台，进入个人中心的"),n("strong",[s._v("访问控制")]),s._v("模块")]),s._v(" "),n("li",[s._v("创建 "),n("strong",[s._v("dns api key")]),s._v(" "),n("ul",[n("li",[s._v("安全起见，我们专门为当前 api 业务创建一个子用户，注意勾选"),n("strong",[s._v("编程访问")]),s._v(" "),n("img",{attrs:{src:"https://pic-bed.sofineday.com/pic.red/blog_picBed2/raw/master/images/20201103093401.png",alt:"aliyun 创建子用户"}})]),s._v(" "),n("li",[s._v("复制"),n("strong",[s._v("AccessKey ID")]),s._v("和"),n("strong",[s._v("AccessKey Secret")]),s._v("\n这 2 个值会在后面步骤用到")]),s._v(" "),n("li",[s._v("为子用户添加权限 AliyunDNSFullAccess")])])])]),s._v(" "),n("h4",{attrs:{id:"_2-2-2-配置系统环境变量"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-2-配置系统环境变量"}},[s._v("#")]),s._v(" 2.2.2 配置系统环境变量")]),s._v(" "),n("p",[s._v("定义如下 2 个环境变量，变量值替换为上一步中从阿里云后台获取的 dns api key。")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('export Ali_Key="sdfsdfsdfljlbjkljlkjsdfoiwje"\nexport Ali_Secret="jlsdflanljkljlfdsaklkjflsa"\n \n        Copied!\n    \n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h4",{attrs:{id:"_2-2-3-生成证书"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-3-生成证书"}},[s._v("#")]),s._v(" 2.2.3 生成证书")]),s._v(" "),n("p",[s._v("执行如下命令，生成证书。将参数替换为实际值即可。")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("acme.sh --issue --dns dns_ali -d sofineday.com -d *.sofineday.com\n \n        Copied!\n    \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("执行过程如下:")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("[root@iZ2ze7011et12xez70sp3dZ nginx]# acme.sh --issue --dns dns_ali -d sofineday.com -d *.sofineday.com\n[2020年 11月 03日 星期二 10:29:00 CST] Domains have changed.\n[2020年 11月 03日 星期二 10:29:00 CST] Using CA: https://acme-v02.api.letsencrypt.org/directory\n[2020年 11月 03日 星期二 10:29:00 CST] Multi domain='DNS:sofineday.com,DNS:*.sofineday.com'\n[2020年 11月 03日 星期二 10:29:00 CST] Getting domain auth token for each domain\n[2020年 11月 03日 星期二 10:29:05 CST] Getting webroot for domain='sofineday.com'\n[2020年 11月 03日 星期二 10:29:05 CST] Getting webroot for domain='*.sofineday.com'\n[2020年 11月 03日 星期二 10:29:05 CST] Adding txt value: D2YeIt9SuAvgUgBxot6qX6ezcwG8-Dv7eaNQY96fDow for domain:  _acme-challenge.sofineday.com\n[2020年 11月 03日 星期二 10:29:07 CST] The txt record is added: Success.\n[2020年 11月 03日 星期二 10:29:07 CST] Let's check each DNS record now. Sleep 20 seconds first.\n[2020年 11月 03日 星期二 10:29:28 CST] Checking sofineday.com for _acme-challenge.sofineday.com\n[2020年 11月 03日 星期二 10:29:31 CST] Domain sofineday.com '_acme-challenge.sofineday.com' success.\n[2020年 11月 03日 星期二 10:29:31 CST] All success, let's return\n[2020年 11月 03日 星期二 10:29:31 CST] sofineday.com is already verified, skip dns-01.\n[2020年 11月 03日 星期二 10:29:31 CST] Verifying: *.sofineday.com\n[2020年 11月 03日 星期二 10:29:35 CST] Success\n[2020年 11月 03日 星期二 10:29:35 CST] Removing DNS records.\n[2020年 11月 03日 星期二 10:29:35 CST] Removing txt: D2YeIt9SuAvgUgBxot6qX6ezcwG8-Dv7eaNQY96fDow for domain: _acme-challenge.sofineday.com\n[2020年 11月 03日 星期二 10:29:39 CST] Removed: Success\n[2020年 11月 03日 星期二 10:29:39 CST] Verify finished, start to sign.\n[2020年 11月 03日 星期二 10:29:39 CST] Lets finalize the order.\n[2020年 11月 03日 星期二 10:29:39 CST] Le_OrderFinalize='https://acme-v02.api.letsencrypt.org/acme/finalize/101071293/6009613602'\n[2020年 11月 03日 星期二 10:29:40 CST] Downloading cert.\n[2020年 11月 03日 星期二 10:29:40 CST] Le_LinkCert='https://acme-v02.api.letsencrypt.org/acme/cert/0307b969bcc3e239c2974cbc9497b1d42730'\n[2020年 11月 03日 星期二 10:29:41 CST] Cert success.\n-----BEGIN CERTIFICATE-----\nMIIFYzCCBEugAwIBAgISAwe5abzD4jnCl0y8lJex1CcwMA0GCSqGSIb3DQEBCwUA\nMEoxCzAJBgNVBAYTAlVTMRYwFAYDVQQKEw1MZXQncyBFbmNyeXB0MSMwIQYDVQQD\nExpMZXQncyBFbmNyeXB0IEF1dGhvcml0eSBYMzAeFw0yMDExMDMwMTI5NDBaFw0y\nMTAyMDEwMTI5NDBaMBgxFjAUBgNVBAMTDXNvZmluZWRheS5jb20wggEiMA0GCSqG\nSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDfAdIati/JZFCEMmTXD4j2UgOwKbKynjHk\nghcW0wA+YyNvIW/Y/kmN4fMk3qEslG6l/XXZ0Lv1IYYStRY70BlUUsHsJ/K/Mu0O\n+EFcCBOfggOoZ8J6RCP1tU/erTq2JJTiWNmlQSqCq92SyJJvVdYYOBRrlMuxtBba\n8pPLjcpxeSO4iEqlNJh+VJNJE1Loh3X77zRBkLwlsetcI/DwKEn670M01l61XMG1\nQMX8RRkp+O4J8Hy6SJlEFv1a320pZJ9IA5D3x8YpgvKJzb5043aN0gPBJ37MVtJq\nMw4NBh9gLk8JKNgbNgJPkJypggLXmGYiLLaFIZEPcoDtjF+xdQ+1AgMBAAGjggJz\nMIICbzAOBgNVHQ8BAf8EBAMCBaAwHQYDVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUF\nBwMCMAwGA1UdEwEB/wQCMAAwHQYDVR0OBBYEFORKHDj/oRKs5nweoobwEffhV0T0\nMB8GA1UdIwQYMBaAFKhKamMEfd265tE5t6ZFZe/zqOyhMG8GCCsGAQUFBwEBBGMw\nYTAuBggrBgEFBQcwAYYiaHR0cDovL29jc3AuaW50LXgzLmxldHNlbmNyeXB0Lm9y\nZzAvBggrBgEFBQcwAoYjaHR0cDovL2NlcnQuaW50LXgzLmxldHNlbmNyeXB0Lm9y\nZy8wKQYDVR0RBCIwIIIPKi5zb2ZpbmVkYXkuY29tgg1zb2ZpbmVkYXkuY29tMEwG\nA1UdIARFMEMwCAYGZ4EMAQIBMDcGCysGAQQBgt8TAQEBMCgwJgYIKwYBBQUHAgEW\nGmh0dHA6Ly9jcHMubGV0c2VuY3J5cHQub3JnMIIBBAYKKwYBBAHWeQIEAgSB9QSB\n8gDwAHYAXNxDkv7mq0VEsV6a1FbmEDf71fpH3KFzlLJe5vbHDsoAAAF1i/BDCgAA\nBAMARzBFAiEA/4/3aI6i8hDRexD0lmhMTnEPZzp3+dIaEhRtNZiSetsCIBdqdotF\nyfi5uj3bcSBoJHfTUgAYLCTGJX4zJSB34rQgAHYA9lyUL9F3MCIUVBgIMJRWjuNN\nExkzv98MLyALzE7xZOMAAAF1i/BDCgAABAMARzBFAiEA3RVYNLqFuEy985akbyOV\nICG2ztPbZpWUPZYymjRABxkCIGi3cqZkBOAuZUmS2U/8Qd27vlOQpL4XgMmM/24T\nqwjrMA0GCSqGSIb3DQEBCwUAA4IBAQBMkWf9jdxzdXc1G1ZE9lJELAsSDjbS79Dv\n5fgz2E/EkFaEoPKVUWGMco3j6N1zfhqBOgwXEZdl1HPa+F4RRaCRh2cjodFzm0Xe\nr9lE9H95ZhePfYuiMWEibIV6jDOWJBqqOjml9pvQXpFdnqIiwAZ6Bj5GiM6ggiZu\nGswmpY/bzwj9YLf9f5VJbRSD4dLm28GRrJGL8sezPZUON44F3I9NbB01JIFPGYkf\n8rhwJFcdEg00micTjsdb21/JaRaG9WBcXCjuGF+3z7rsIvK4ZxltkNqUmvD+c44W\nDleXTCzniMPbjugvDF+T1wf1mGM9MsBmuuTGLAPvCLjvYTKOtW48\n-----END CERTIFICATE-----\n[2020年 11月 03日 星期二 10:29:41 CST] Your cert is in  /root/.acme.sh/sofineday.com/sofineday.com.cer\n[2020年 11月 03日 星期二 10:29:41 CST] Your cert key is in  /root/.acme.sh/sofineday.com/sofineday.com.key\n[2020年 11月 03日 星期二 10:29:41 CST] The intermediate CA cert is in  /root/.acme.sh/sofineday.com/ca.cer\n[2020年 11月 03日 星期二 10:29:41 CST] And the full chain certs is there:  /root/.acme.sh/sofineday.com/fullchain.cer\n[root@iZ2ze7011et12xez70sp3dZ nginx]#\n[root@iZ2ze7011et12xez70sp3dZ nginx]# acme.sh --list\nMain_Domain    KeyLength  SAN_Domains      CA               Created                               Renew\nsofineday.com  \"\"         *.sofineday.com  LetsEncrypt.org  2020年 11月 03日 星期二 02:29:41 UTC  2021年 01月 02日 星期六 02:29:41 UTC\n[root@iZ2ze7011et12xez70sp3dZ nginx]#\n \n        Copied!\n    \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br")])]),n("blockquote",[n("p",[s._v("默认 acme.sh 会在证书生成 60 天后执行续期(您可以通过 acme.sh --list 输出的 Created 和 Renew 列看出)。若想对该值做自定义，指定--days 参数即可，如: "),n("strong",[n("code",[s._v("acme.sh --issue --dns dns_ali -d sofineday.com -d \\*.sofineday.com --days 90")])])])]),s._v(" "),n("h3",{attrs:{id:"_2-3-选择ca服务器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-选择ca服务器"}},[s._v("#")]),s._v(" 2.3 选择CA服务器")]),s._v(" "),n("p",[s._v("当前最新版本的acme.sh，默认情况下使用的CA服务器是"),n("code",[s._v("zerossl")]),s._v("，那么在”生成证书命令“可能会执行失败，那么可以选择其他CA服务器。")]),s._v(" "),n("p",[s._v("acme.sh支持4个CA服务器，分别是 Let's Encrypt、Buypass、ZeroSSL 和 SSL.com，默认使用 ZeroSSL。\n对应的设置命令如下：")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("acme.sh --set-default-ca --server letsencrypt\nacme.sh --set-default-ca --server buypass\nacme.sh --set-default-ca --server zerossl\n \n        Copied!\n    \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[s._v("示例如下:")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("root@VM-0-6-ubuntu:~# acme.sh --issue --dns dns_ali -d sofineday.com -d *.sofineday.com\n[Sat 09 Apr 2022 09:00:22 PM CST] Using CA: https://acme.zerossl.com/v2/DV90\n[Sat 09 Apr 2022 09:00:22 PM CST] Multi domain='DNS:sofineday.com,DNS:*.sofineday.com'\n[Sat 09 Apr 2022 09:00:22 PM CST] Getting domain auth token for each domain\n[Sat 09 Apr 2022 09:01:03 PM CST] Getting webroot for domain='sofineday.com'\n[Sat 09 Apr 2022 09:01:03 PM CST] Getting webroot for domain='*.sofineday.com'\n[Sat 09 Apr 2022 09:01:03 PM CST] Adding txt value: uart28HH2nrmXvUHuanWanlUcwQdijubkD2tBlvtBWM for domain:  _acme-challenge.sofineday.com\n[Sat 09 Apr 2022 09:01:05 PM CST] The txt record is added: Success.\n[Sat 09 Apr 2022 09:01:05 PM CST] Adding txt value: 8vauPgEuUjFL124BNSG1-gqSzXtyKKKsa8uO19gICpA for domain:  _acme-challenge.sofineday.com\n[Sat 09 Apr 2022 09:01:07 PM CST] The txt record is added: Success.\n[Sat 09 Apr 2022 09:01:07 PM CST] Let's check each DNS record now. Sleep 20 seconds first.\n[Sat 09 Apr 2022 09:01:28 PM CST] You can use '--dnssleep' to disable public dns checks.\n[Sat 09 Apr 2022 09:01:28 PM CST] See: https://github.com/acmesh-official/acme.sh/wiki/dnscheck\n[Sat 09 Apr 2022 09:01:28 PM CST] Checking sofineday.com for _acme-challenge.sofineday.com\n[Sat 09 Apr 2022 09:01:31 PM CST] Domain sofineday.com '_acme-challenge.sofineday.com' success.\n[Sat 09 Apr 2022 09:01:31 PM CST] Checking sofineday.com for _acme-challenge.sofineday.com\n[Sat 09 Apr 2022 09:01:33 PM CST] Domain sofineday.com '_acme-challenge.sofineday.com' success.\n[Sat 09 Apr 2022 09:01:33 PM CST] All success, let's return\n[Sat 09 Apr 2022 09:01:33 PM CST] Verifying: sofineday.com\n[Sat 09 Apr 2022 09:01:38 PM CST] Processing, The CA is processing your order, please just wait. (1/30)\n[Sat 09 Apr 2022 09:01:50 PM CST] Success\n[Sat 09 Apr 2022 09:01:50 PM CST] Verifying: *.sofineday.com\n[Sat 09 Apr 2022 09:01:59 PM CST] Processing, The CA is processing your order, please just wait. (1/30)\n[Sat 09 Apr 2022 09:02:15 PM CST] Success\n[Sat 09 Apr 2022 09:02:15 PM CST] Removing DNS records.\n[Sat 09 Apr 2022 09:02:15 PM CST] Removing txt: uart28HH2nrmXvUHuanWanlUcwQdijubkD2tBlvtBWM for domain: _acme-challenge.sofineday.com\n[Sat 09 Apr 2022 09:02:18 PM CST] Removed: Success\n[Sat 09 Apr 2022 09:02:18 PM CST] Removing txt: 8vauPgEuUjFL124BNSG1-gqSzXtyKKKsa8uO19gICpA for domain: _acme-challenge.sofineday.com\n[Sat 09 Apr 2022 09:02:20 PM CST] Removed: Success\n[Sat 09 Apr 2022 09:02:20 PM CST] Verify finished, start to sign.\n[Sat 09 Apr 2022 09:02:20 PM CST] Lets finalize the order.\n[Sat 09 Apr 2022 09:02:20 PM CST] Le_OrderFinalize='https://acme.zerossl.com/v2/DV90/order/9P4RbhWgIVoaIPvAuCh5zw/finalize'\n[Sat 09 Apr 2022 09:02:27 PM CST] Order status is processing, lets sleep and retry.\n[Sat 09 Apr 2022 09:02:27 PM CST] Retry after: 15\n[Sat 09 Apr 2022 09:02:43 PM CST] Polling order status: https://acme.zerossl.com/v2/DV90/order/9P4RbhWgIVoaIPvAuCh5zw\n[Sat 09 Apr 2022 09:02:50 PM CST] Order status is processing, lets sleep and retry.\n[Sat 09 Apr 2022 09:02:50 PM CST] Retry after: 15\n[Sat 09 Apr 2022 09:03:06 PM CST] Polling order status: https://acme.zerossl.com/v2/DV90/order/9P4RbhWgIVoaIPvAuCh5zw\n[Sat 09 Apr 2022 09:03:13 PM CST] Order status is processing, lets sleep and retry.\n[Sat 09 Apr 2022 09:03:13 PM CST] Retry after: 15\n[Sat 09 Apr 2022 09:03:30 PM CST] Polling order status: https://acme.zerossl.com/v2/DV90/order/9P4RbhWgIVoaIPvAuCh5zw\n[Sat 09 Apr 2022 09:03:38 PM CST] Order status is processing, lets sleep and retry.\n[Sat 09 Apr 2022 09:03:38 PM CST] Retry after: 15\n[Sat 09 Apr 2022 09:03:54 PM CST] Polling order status: https://acme.zerossl.com/v2/DV90/order/9P4RbhWgIVoaIPvAuCh5zw\n[Sat 09 Apr 2022 09:04:00 PM CST] Order status is processing, lets sleep and retry.\n[Sat 09 Apr 2022 09:04:00 PM CST] Retry after: 15\n[Sat 09 Apr 2022 09:04:16 PM CST] Polling order status: https://acme.zerossl.com/v2/DV90/order/9P4RbhWgIVoaIPvAuCh5zw\n[Sat 09 Apr 2022 09:04:21 PM CST] Order status is processing, lets sleep and retry.\n[Sat 09 Apr 2022 09:04:21 PM CST] Retry after: 15\n[Sat 09 Apr 2022 09:04:37 PM CST] Polling order status: https://acme.zerossl.com/v2/DV90/order/9P4RbhWgIVoaIPvAuCh5zw\n[Sat 09 Apr 2022 09:04:41 PM CST] Order status is processing, lets sleep and retry.\n[Sat 09 Apr 2022 09:04:41 PM CST] Retry after: 15\n[Sat 09 Apr 2022 09:04:57 PM CST] Polling order status: https://acme.zerossl.com/v2/DV90/order/9P4RbhWgIVoaIPvAuCh5zw\n[Sat 09 Apr 2022 09:05:11 PM CST] Order status is processing, lets sleep and retry.\n[Sat 09 Apr 2022 09:05:11 PM CST] Retry after: 15\n[Sat 09 Apr 2022 09:05:27 PM CST] Polling order status: https://acme.zerossl.com/v2/DV90/order/9P4RbhWgIVoaIPvAuCh5zw\n[Sat 09 Apr 2022 09:05:35 PM CST] Order status is processing, lets sleep and retry.\n[Sat 09 Apr 2022 09:05:35 PM CST] Retry after: 15\n[Sat 09 Apr 2022 09:05:51 PM CST] Polling order status: https://acme.zerossl.com/v2/DV90/order/9P4RbhWgIVoaIPvAuCh5zw\n[Sat 09 Apr 2022 09:06:00 PM CST] Order status is processing, lets sleep and retry.\n[Sat 09 Apr 2022 09:06:00 PM CST] Retry after: 15\n[Sat 09 Apr 2022 09:06:16 PM CST] Polling order status: https://acme.zerossl.com/v2/DV90/order/9P4RbhWgIVoaIPvAuCh5zw\n[Sat 09 Apr 2022 09:06:25 PM CST] Order status is processing, lets sleep and retry.\n[Sat 09 Apr 2022 09:06:25 PM CST] Retry after: 15\n[Sat 09 Apr 2022 09:06:41 PM CST] Polling order status: https://acme.zerossl.com/v2/DV90/order/9P4RbhWgIVoaIPvAuCh5zw\n[Sat 09 Apr 2022 09:06:46 PM CST] Order status is processing, lets sleep and retry.\n[Sat 09 Apr 2022 09:06:46 PM CST] Retry after: 15\n[Sat 09 Apr 2022 09:07:02 PM CST] Polling order status: https://acme.zerossl.com/v2/DV90/order/9P4RbhWgIVoaIPvAuCh5zw\n[Sat 09 Apr 2022 09:07:08 PM CST] Order status is processing, lets sleep and retry.\n[Sat 09 Apr 2022 09:07:08 PM CST] Retry after: 15\n[Sat 09 Apr 2022 09:07:24 PM CST] Polling order status: https://acme.zerossl.com/v2/DV90/order/9P4RbhWgIVoaIPvAuCh5zw\n[Sat 09 Apr 2022 09:07:30 PM CST] Order status is processing, lets sleep and retry.\n[Sat 09 Apr 2022 09:07:30 PM CST] Retry after: 15\n[Sat 09 Apr 2022 09:07:46 PM CST] Polling order status: https://acme.zerossl.com/v2/DV90/order/9P4RbhWgIVoaIPvAuCh5zw\n[Sat 09 Apr 2022 09:07:51 PM CST] Order status is processing, lets sleep and retry.\n[Sat 09 Apr 2022 09:07:51 PM CST] Retry after: 15\n7\n\n[Sat 09 Apr 2022 09:08:07 PM CST] Polling order status: https://acme.zerossl.com/v2/DV90/order/9P4RbhWgIVoaIPvAuCh5zw\n[Sat 09 Apr 2022 09:08:15 PM CST] Order status is processing, lets sleep and retry.\n[Sat 09 Apr 2022 09:08:15 PM CST] Retry after: 15\n[Sat 09 Apr 2022 09:08:31 PM CST] Polling order status: https://acme.zerossl.com/v2/DV90/order/9P4RbhWgIVoaIPvAuCh5zw\n[Sat 09 Apr 2022 09:08:38 PM CST] Order status is processing, lets sleep and retry.\n[Sat 09 Apr 2022 09:08:38 PM CST] Retry after: 15\n[Sat 09 Apr 2022 09:08:54 PM CST] Polling order status: https://acme.zerossl.com/v2/DV90/order/9P4RbhWgIVoaIPvAuCh5zw\n[Sat 09 Apr 2022 09:09:02 PM CST] Order status is processing, lets sleep and retry.\n[Sat 09 Apr 2022 09:09:02 PM CST] Retry after: 15\n[Sat 09 Apr 2022 09:09:18 PM CST] Polling order status: https://acme.zerossl.com/v2/DV90/order/9P4RbhWgIVoaIPvAuCh5zw\n[Sat 09 Apr 2022 09:09:28 PM CST] Order status is processing, lets sleep and retry.\n[Sat 09 Apr 2022 09:09:28 PM CST] Retry after: 15\n[Sat 09 Apr 2022 09:09:44 PM CST] Polling order status: https://acme.zerossl.com/v2/DV90/order/9P4RbhWgIVoaIPvAuCh5zw\n[Sat 09 Apr 2022 09:09:51 PM CST] Order status is processing, lets sleep and retry.\n[Sat 09 Apr 2022 09:09:51 PM CST] Retry after: 15\n[Sat 09 Apr 2022 09:10:07 PM CST] Polling order status: https://acme.zerossl.com/v2/DV90/order/9P4RbhWgIVoaIPvAuCh5zw\n[Sat 09 Apr 2022 09:10:15 PM CST] Order status is processing, lets sleep and retry.\n[Sat 09 Apr 2022 09:10:15 PM CST] Retry after: 15\n[Sat 09 Apr 2022 09:10:31 PM CST] Polling order status: https://acme.zerossl.com/v2/DV90/order/9P4RbhWgIVoaIPvAuCh5zw\n[Sat 09 Apr 2022 09:10:39 PM CST] Order status is processing, lets sleep and retry.\n[Sat 09 Apr 2022 09:10:39 PM CST] Retry after: 15\n[Sat 09 Apr 2022 09:10:55 PM CST] Polling order status: https://acme.zerossl.com/v2/DV90/order/9P4RbhWgIVoaIPvAuCh5zw\n[Sat 09 Apr 2022 09:11:04 PM CST] Order status is processing, lets sleep and retry.\n[Sat 09 Apr 2022 09:11:04 PM CST] Retry after: 15\n[Sat 09 Apr 2022 09:11:20 PM CST] Polling order status: https://acme.zerossl.com/v2/DV90/order/9P4RbhWgIVoaIPvAuCh5zw\n[Sat 09 Apr 2022 09:11:30 PM CST] Order status is processing, lets sleep and retry.\n[Sat 09 Apr 2022 09:11:30 PM CST] Retry after: 15\n[Sat 09 Apr 2022 09:11:46 PM CST] Polling order status: https://acme.zerossl.com/v2/DV90/order/9P4RbhWgIVoaIPvAuCh5zw\n[Sat 09 Apr 2022 09:11:55 PM CST] Order status is processing, lets sleep and retry.\n[Sat 09 Apr 2022 09:11:55 PM CST] Retry after: 15\n[Sat 09 Apr 2022 09:12:11 PM CST] Polling order status: https://acme.zerossl.com/v2/DV90/order/9P4RbhWgIVoaIPvAuCh5zw\n[Sat 09 Apr 2022 09:12:17 PM CST] Order status is processing, lets sleep and retry.\n[Sat 09 Apr 2022 09:12:17 PM CST] Retry after: 15\n[Sat 09 Apr 2022 09:12:33 PM CST] Polling order status: https://acme.zerossl.com/v2/DV90/order/9P4RbhWgIVoaIPvAuCh5zw\n[Sat 09 Apr 2022 09:12:38 PM CST] Order status is processing, lets sleep and retry.\n[Sat 09 Apr 2022 09:12:38 PM CST] Retry after: 15\n[Sat 09 Apr 2022 09:12:54 PM CST] Polling order status: https://acme.zerossl.com/v2/DV90/order/9P4RbhWgIVoaIPvAuCh5zw\n[Sat 09 Apr 2022 09:13:02 PM CST] Order status is processing, lets sleep and retry.\n[Sat 09 Apr 2022 09:13:02 PM CST] Retry after: 15\n[Sat 09 Apr 2022 09:13:18 PM CST] Polling order status: https://acme.zerossl.com/v2/DV90/order/9P4RbhWgIVoaIPvAuCh5zw\n[Sat 09 Apr 2022 09:13:24 PM CST] Order status is processing, lets sleep and retry.\n[Sat 09 Apr 2022 09:13:24 PM CST] Retry after: 15\n[Sat 09 Apr 2022 09:13:40 PM CST] Polling order status: https://acme.zerossl.com/v2/DV90/order/9P4RbhWgIVoaIPvAuCh5zw\n[Sat 09 Apr 2022 09:13:50 PM CST] Order status is processing, lets sleep and retry.\n[Sat 09 Apr 2022 09:13:50 PM CST] Retry after: 15\n[Sat 09 Apr 2022 09:14:06 PM CST] Polling order status: https://acme.zerossl.com/v2/DV90/order/9P4RbhWgIVoaIPvAuCh5zw\n[Sat 09 Apr 2022 09:14:16 PM CST] Sign failed, can not get Le_LinkCert, retry time limit.\n[Sat 09 Apr 2022 09:14:16 PM CST] {\"status\":\"processing\",\"expires\":\"2022-07-08T13:00:44Z\",\"identifiers\":[{\"type\":\"dns\",\"value\":\"sofineday.com\"},{\"type\":\"dns\",\"value\":\"*.sofineday.com\"}],\"authorizations\":[\"https://acme.zerossl.com/v2/DV90/authz/uNHGSChx4Y0zPX0-CjoPqQ\",\"https://acme.zerossl.com/v2/DV90/authz/ArKxq9XJFIex2A675unajg\"],\"finalize\":\"https://acme.zerossl.com/v2/DV90/order/9P4RbhWgIVoaIPvAuCh5zw/finalize\"}\n[Sat 09 Apr 2022 09:14:16 PM CST] Please add '--debug' or '--log' to check more details.\n[Sat 09 Apr 2022 09:14:16 PM CST] See: https://github.com/acmesh-official/acme.sh/wiki/How-to-debug-acme.sh\nroot@VM-0-6-ubuntu:~#\nroot@VM-0-6-ubuntu:~#\nroot@VM-0-6-ubuntu:~# acme.sh --issue --dns dns_ali -d sofineday.com -d *.sofineday.com --server letsencrypt\n[Sat 09 Apr 2022 09:17:44 PM CST] Using CA: https://acme-v02.api.letsencrypt.org/directory\n[Sat 09 Apr 2022 09:17:44 PM CST] Create account key ok.\n[Sat 09 Apr 2022 09:17:44 PM CST] Registering account: https://acme-v02.api.letsencrypt.org/directory\n[Sat 09 Apr 2022 09:17:51 PM CST] Registered\n[Sat 09 Apr 2022 09:17:51 PM CST] ACCOUNT_THUMBPRINT='Vqg9KL25_J013ZSP2sjqGyWV1iQ9pTEml2LbJ5XtlpA'\n[Sat 09 Apr 2022 09:17:51 PM CST] Multi domain='DNS:sofineday.com,DNS:*.sofineday.com'\n[Sat 09 Apr 2022 09:17:51 PM CST] Getting domain auth token for each domain\n[Sat 09 Apr 2022 09:17:55 PM CST] Getting webroot for domain='sofineday.com'\n[Sat 09 Apr 2022 09:17:55 PM CST] Getting webroot for domain='*.sofineday.com'\n[Sat 09 Apr 2022 09:17:55 PM CST] Adding txt value: J6Fijfd78wgVKOqQ9AZzhMzlq60WwCeuHCXxr0ao80I for domain:  _acme-challenge.sofineday.com\n[Sat 09 Apr 2022 09:17:58 PM CST] The txt record is added: Success.\n[Sat 09 Apr 2022 09:17:58 PM CST] Adding txt value: vl7Dmv3I3K83yeVwUQUg6l9SGpzhj0c06W87cyhwdhc for domain:  _acme-challenge.sofineday.com\n[Sat 09 Apr 2022 09:17:59 PM CST] The txt record is added: Success.\n[Sat 09 Apr 2022 09:17:59 PM CST] Let's check each DNS record now. Sleep 20 seconds first.\n[Sat 09 Apr 2022 09:18:21 PM CST] You can use '--dnssleep' to disable public dns checks.\n[Sat 09 Apr 2022 09:18:21 PM CST] See: https://github.com/acmesh-official/acme.sh/wiki/dnscheck\n[Sat 09 Apr 2022 09:18:21 PM CST] Checking sofineday.com for _acme-challenge.sofineday.com\n[Sat 09 Apr 2022 09:18:22 PM CST] Domain sofineday.com '_acme-challenge.sofineday.com' success.\n[Sat 09 Apr 2022 09:18:22 PM CST] Checking sofineday.com for _acme-challenge.sofineday.com\n[Sat 09 Apr 2022 09:18:24 PM CST] Domain sofineday.com '_acme-challenge.sofineday.com' success.\n[Sat 09 Apr 2022 09:18:24 PM CST] All success, let's return\n[Sat 09 Apr 2022 09:18:24 PM CST] Verifying: sofineday.com\n[Sat 09 Apr 2022 09:18:24 PM CST] Pending, The CA is processing your order, please just wait. (1/30)\n[Sat 09 Apr 2022 09:18:28 PM CST] Success\n[Sat 09 Apr 2022 09:18:28 PM CST] Verifying: *.sofineday.com\n[Sat 09 Apr 2022 09:18:31 PM CST] Pending, The CA is processing your order, please just wait. (1/30)\n[Sat 09 Apr 2022 09:18:33 PM CST] Success\n[Sat 09 Apr 2022 09:18:33 PM CST] Removing DNS records.\n[Sat 09 Apr 2022 09:18:33 PM CST] Removing txt: J6Fijfd78wgVKOqQ9AZzhMzlq60WwCeuHCXxr0ao80I for domain: _acme-challenge.sofineday.com\n[Sat 09 Apr 2022 09:18:36 PM CST] Removed: Success\n[Sat 09 Apr 2022 09:18:36 PM CST] Removing txt: vl7Dmv3I3K83yeVwUQUg6l9SGpzhj0c06W87cyhwdhc for domain: _acme-challenge.sofineday.com\n[Sat 09 Apr 2022 09:18:39 PM CST] Removed: Success\n[Sat 09 Apr 2022 09:18:39 PM CST] Verify finished, start to sign.\n[Sat 09 Apr 2022 09:18:39 PM CST] Lets finalize the order.\n[Sat 09 Apr 2022 09:18:39 PM CST] Le_OrderFinalize='https://acme-v02.api.letsencrypt.org/acme/finalize/489730070/78685657260'\n[Sat 09 Apr 2022 09:18:40 PM CST] Downloading cert.\n[Sat 09 Apr 2022 09:18:40 PM CST] Le_LinkCert='https://acme-v02.api.letsencrypt.org/acme/cert/03c0eb027c64ee2385bc63164c6859c78936'\n[Sat 09 Apr 2022 09:18:41 PM CST] Cert success.\n-----BEGIN CERTIFICATE-----\nMIIFMjCCBBqgAwIBAgISA8DrAnxk7iOFvGMWTGhZx4k2MA0GCSqGSIb3DQEBCwUA\nMDIxCzAJBgNVBAYTAlVTMRYwFAYDVQQKEw1MZXQncyBFbmNyeXB0MQswCQYDVQQD\nEwJSMzAeFw0yMjA0MDkxMjE4MzlaFw0yMjA3MDgxMjE4MzhaMBgxFjAUBgNVBAMT\nDXNvZmluZWRheS5jb20wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDA\n9Db5gZwDb5hDJrsVdjgWz8Vo3i8LdbJI+ekWZCaqd5bRkkiQlsG+eR7R8EFx523h\na9gZIsKwRxfPHbtmhwi2dbEC5lp9JnHUwiyuGlj+7hWWD6tk+qJZDsNhGSNJLDHU\naSQZPtHNLLgQe+4Ebza1YzZjrbckJYoLU9Z/QBW7bJ663HZPtqVgYmNPJp/6vRM/\nobU5nMeIiBtbKlKbLj/GiY6qfJZaTsFsKweXgWpKP3T2R+DUZzr+X/e74gRrfJvv\nM6GH4nlYfXQUDVMTPJr5mxucDIcfCF0GoI/HWDGygm+TP2IcCMB++brUiHWGFpBF\nBJzTuSmjz6rMXT2bMEp7AgMBAAGjggJaMIICVjAOBgNVHQ8BAf8EBAMCBaAwHQYD\nVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMCMAwGA1UdEwEB/wQCMAAwHQYDVR0O\nBBYEFAfHx5ZjyHE2HFxemnD48j+U64F8MB8GA1UdIwQYMBaAFBQusxe3WFbLrlAJ\nQOYfr52LFMLGMFUGCCsGAQUFBwEBBEkwRzAhBggrBgEFBQcwAYYVaHR0cDovL3Iz\nLm8ubGVuY3Iub3JnMCIGCCsGAQUFBzAChhZodHRwOi8vcjMuaS5sZW5jci5vcmcv\nMCkGA1UdEQQiMCCCDyouc29maW5lZGF5LmNvbYINc29maW5lZGF5LmNvbTBMBgNV\nHSAERTBDMAgGBmeBDAECATA3BgsrBgEEAYLfEwEBATAoMCYGCCsGAQUFBwIBFhpo\ndHRwOi8vY3BzLmxldHNlbmNyeXB0Lm9yZzCCAQUGCisGAQQB1nkCBAIEgfYEgfMA\n8QB3AEHIyrHfIkZKEMahOglCh15OMYsbA+vrS8do8JBilgb2AAABgA56B4EAAAQD\nAEgwRgIhAOfjvcPoqyBNuO8kp0xhg4TWYRd1tD8lkJpTNqjsHvydAiEAwVTCAgDm\nXpheyaepkfeDjg2/9lzd9mboO/yzziiqHNIAdgBGpVXrdfqRIDC1oolp9PN9ESxB\ndL79SbiFq/L8cP5tRwAAAYAOege7AAAEAwBHMEUCIQC/xWJZ35gtp0WjjAib7psE\na0noXK4+zb9XyE/ksoligQIgLnncKjYGaX0vDSAgCktv86/xUMydFhU4QxKYwo6C\nfnowDQYJKoZIhvcNAQELBQADggEBALWb+zJkZPE27Xcsfepij5QUfbmQRgjUeJE3\nyawPYswWc+6CWQghlzr3dlXyT3ExAQxFi2t5N7cKneUaJtDO0tvDH/VaaEUgYpzE\nRvwW/v8pjYQVqyMduT881vFcz0rjZC5sAMKHtE1esrJrD2ApJVDG3dTB3i0S3L6l\nhEmmzBQdjK1NbIh3gpcpaHfwSjqr9zRIA/tKFqO0NUbx2tn4+XnO34AZMZOGjB+F\n+WVf02er748xvDxqzVwIzIi9DQDz1t6ESMPQZC07o9VTl2vwxtWEq/ic5KmwpZhe\n1btv6iZJHEtZQE5WzPYGcxYPTsfg3OEYJSomr2KT0RntTKC6nVo=\n-----END CERTIFICATE-----\n[Sat 09 Apr 2022 09:18:41 PM CST] Your cert is in: /root/.acme.sh/sofineday.com/sofineday.com.cer\n[Sat 09 Apr 2022 09:18:41 PM CST] Your cert key is in: /root/.acme.sh/sofineday.com/sofineday.com.key\n[Sat 09 Apr 2022 09:18:41 PM CST] The intermediate CA cert is in: /root/.acme.sh/sofineday.com/ca.cer\n[Sat 09 Apr 2022 09:18:41 PM CST] And the full chain certs is there: /root/.acme.sh/sofineday.com/fullchain.cer\nroot@VM-0-6-ubuntu:~#\n \n        Copied!\n    \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br"),n("span",{staticClass:"line-number"},[s._v("94")]),n("br"),n("span",{staticClass:"line-number"},[s._v("95")]),n("br"),n("span",{staticClass:"line-number"},[s._v("96")]),n("br"),n("span",{staticClass:"line-number"},[s._v("97")]),n("br"),n("span",{staticClass:"line-number"},[s._v("98")]),n("br"),n("span",{staticClass:"line-number"},[s._v("99")]),n("br"),n("span",{staticClass:"line-number"},[s._v("100")]),n("br"),n("span",{staticClass:"line-number"},[s._v("101")]),n("br"),n("span",{staticClass:"line-number"},[s._v("102")]),n("br"),n("span",{staticClass:"line-number"},[s._v("103")]),n("br"),n("span",{staticClass:"line-number"},[s._v("104")]),n("br"),n("span",{staticClass:"line-number"},[s._v("105")]),n("br"),n("span",{staticClass:"line-number"},[s._v("106")]),n("br"),n("span",{staticClass:"line-number"},[s._v("107")]),n("br"),n("span",{staticClass:"line-number"},[s._v("108")]),n("br"),n("span",{staticClass:"line-number"},[s._v("109")]),n("br"),n("span",{staticClass:"line-number"},[s._v("110")]),n("br"),n("span",{staticClass:"line-number"},[s._v("111")]),n("br"),n("span",{staticClass:"line-number"},[s._v("112")]),n("br"),n("span",{staticClass:"line-number"},[s._v("113")]),n("br"),n("span",{staticClass:"line-number"},[s._v("114")]),n("br"),n("span",{staticClass:"line-number"},[s._v("115")]),n("br"),n("span",{staticClass:"line-number"},[s._v("116")]),n("br"),n("span",{staticClass:"line-number"},[s._v("117")]),n("br"),n("span",{staticClass:"line-number"},[s._v("118")]),n("br"),n("span",{staticClass:"line-number"},[s._v("119")]),n("br"),n("span",{staticClass:"line-number"},[s._v("120")]),n("br"),n("span",{staticClass:"line-number"},[s._v("121")]),n("br"),n("span",{staticClass:"line-number"},[s._v("122")]),n("br"),n("span",{staticClass:"line-number"},[s._v("123")]),n("br"),n("span",{staticClass:"line-number"},[s._v("124")]),n("br"),n("span",{staticClass:"line-number"},[s._v("125")]),n("br"),n("span",{staticClass:"line-number"},[s._v("126")]),n("br"),n("span",{staticClass:"line-number"},[s._v("127")]),n("br"),n("span",{staticClass:"line-number"},[s._v("128")]),n("br"),n("span",{staticClass:"line-number"},[s._v("129")]),n("br"),n("span",{staticClass:"line-number"},[s._v("130")]),n("br"),n("span",{staticClass:"line-number"},[s._v("131")]),n("br"),n("span",{staticClass:"line-number"},[s._v("132")]),n("br"),n("span",{staticClass:"line-number"},[s._v("133")]),n("br"),n("span",{staticClass:"line-number"},[s._v("134")]),n("br"),n("span",{staticClass:"line-number"},[s._v("135")]),n("br"),n("span",{staticClass:"line-number"},[s._v("136")]),n("br"),n("span",{staticClass:"line-number"},[s._v("137")]),n("br"),n("span",{staticClass:"line-number"},[s._v("138")]),n("br"),n("span",{staticClass:"line-number"},[s._v("139")]),n("br"),n("span",{staticClass:"line-number"},[s._v("140")]),n("br"),n("span",{staticClass:"line-number"},[s._v("141")]),n("br"),n("span",{staticClass:"line-number"},[s._v("142")]),n("br"),n("span",{staticClass:"line-number"},[s._v("143")]),n("br"),n("span",{staticClass:"line-number"},[s._v("144")]),n("br"),n("span",{staticClass:"line-number"},[s._v("145")]),n("br"),n("span",{staticClass:"line-number"},[s._v("146")]),n("br"),n("span",{staticClass:"line-number"},[s._v("147")]),n("br"),n("span",{staticClass:"line-number"},[s._v("148")]),n("br"),n("span",{staticClass:"line-number"},[s._v("149")]),n("br"),n("span",{staticClass:"line-number"},[s._v("150")]),n("br"),n("span",{staticClass:"line-number"},[s._v("151")]),n("br"),n("span",{staticClass:"line-number"},[s._v("152")]),n("br"),n("span",{staticClass:"line-number"},[s._v("153")]),n("br"),n("span",{staticClass:"line-number"},[s._v("154")]),n("br"),n("span",{staticClass:"line-number"},[s._v("155")]),n("br"),n("span",{staticClass:"line-number"},[s._v("156")]),n("br"),n("span",{staticClass:"line-number"},[s._v("157")]),n("br"),n("span",{staticClass:"line-number"},[s._v("158")]),n("br"),n("span",{staticClass:"line-number"},[s._v("159")]),n("br"),n("span",{staticClass:"line-number"},[s._v("160")]),n("br"),n("span",{staticClass:"line-number"},[s._v("161")]),n("br"),n("span",{staticClass:"line-number"},[s._v("162")]),n("br"),n("span",{staticClass:"line-number"},[s._v("163")]),n("br"),n("span",{staticClass:"line-number"},[s._v("164")]),n("br"),n("span",{staticClass:"line-number"},[s._v("165")]),n("br"),n("span",{staticClass:"line-number"},[s._v("166")]),n("br"),n("span",{staticClass:"line-number"},[s._v("167")]),n("br"),n("span",{staticClass:"line-number"},[s._v("168")]),n("br"),n("span",{staticClass:"line-number"},[s._v("169")]),n("br"),n("span",{staticClass:"line-number"},[s._v("170")]),n("br"),n("span",{staticClass:"line-number"},[s._v("171")]),n("br"),n("span",{staticClass:"line-number"},[s._v("172")]),n("br"),n("span",{staticClass:"line-number"},[s._v("173")]),n("br"),n("span",{staticClass:"line-number"},[s._v("174")]),n("br"),n("span",{staticClass:"line-number"},[s._v("175")]),n("br"),n("span",{staticClass:"line-number"},[s._v("176")]),n("br"),n("span",{staticClass:"line-number"},[s._v("177")]),n("br"),n("span",{staticClass:"line-number"},[s._v("178")]),n("br"),n("span",{staticClass:"line-number"},[s._v("179")]),n("br"),n("span",{staticClass:"line-number"},[s._v("180")]),n("br"),n("span",{staticClass:"line-number"},[s._v("181")]),n("br"),n("span",{staticClass:"line-number"},[s._v("182")]),n("br"),n("span",{staticClass:"line-number"},[s._v("183")]),n("br"),n("span",{staticClass:"line-number"},[s._v("184")]),n("br"),n("span",{staticClass:"line-number"},[s._v("185")]),n("br"),n("span",{staticClass:"line-number"},[s._v("186")]),n("br"),n("span",{staticClass:"line-number"},[s._v("187")]),n("br"),n("span",{staticClass:"line-number"},[s._v("188")]),n("br"),n("span",{staticClass:"line-number"},[s._v("189")]),n("br"),n("span",{staticClass:"line-number"},[s._v("190")]),n("br"),n("span",{staticClass:"line-number"},[s._v("191")]),n("br"),n("span",{staticClass:"line-number"},[s._v("192")]),n("br"),n("span",{staticClass:"line-number"},[s._v("193")]),n("br"),n("span",{staticClass:"line-number"},[s._v("194")]),n("br"),n("span",{staticClass:"line-number"},[s._v("195")]),n("br"),n("span",{staticClass:"line-number"},[s._v("196")]),n("br"),n("span",{staticClass:"line-number"},[s._v("197")]),n("br"),n("span",{staticClass:"line-number"},[s._v("198")]),n("br"),n("span",{staticClass:"line-number"},[s._v("199")]),n("br"),n("span",{staticClass:"line-number"},[s._v("200")]),n("br"),n("span",{staticClass:"line-number"},[s._v("201")]),n("br"),n("span",{staticClass:"line-number"},[s._v("202")]),n("br"),n("span",{staticClass:"line-number"},[s._v("203")]),n("br"),n("span",{staticClass:"line-number"},[s._v("204")]),n("br"),n("span",{staticClass:"line-number"},[s._v("205")]),n("br"),n("span",{staticClass:"line-number"},[s._v("206")]),n("br"),n("span",{staticClass:"line-number"},[s._v("207")]),n("br")])]),n("p",[s._v("通过如上的真实示例可以看出，命令"),n("code",[s._v("acme.sh --issue --dns dns_ali -d sofineday.com -d *.sofineday.com")]),s._v("执行失败，改为"),n("code",[s._v("acme.sh --issue --dns dns_ali -d sofineday.com -d *.sofineday.com --server letsencrypt")]),s._v("后执行成功了。")]),s._v(" "),n("h2",{attrs:{id:"_3-安装证书"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-安装证书"}},[s._v("#")]),s._v(" 3. 安装证书")]),s._v(" "),n("h3",{attrs:{id:"_3-1-安装证书"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-安装证书"}},[s._v("#")]),s._v(" 3.1 安装证书")]),s._v(" "),n("p",[s._v("执行如下命令将前面生成的证书安装到 nginx 中。本质上就是拷贝证书文件到 nginx 的证书目录下。\n"),n("strong",[s._v("该命令会被 ACME 记录下来，当做")]),s._v("证书更新"),n("strong",[s._v("操作时，会自动执行该命令")])]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('acme.sh  --installcert -d sofineday.com \\\n         --key-file /data/docker-service/nginx/cert/_.sofineday.com.private.key \\\n         --fullchain-file /data/docker-service/nginx/cert/_.sofineday.com.full_chain.pem \\\n         --reloadcmd "docker cp /data/docker-service/nginx/cert/_.sofineday.com.private.key nginx:/etc/nginx/cert/ &amp;&amp; docker cp /data/docker-service/nginx/cert/_.sofineday.com.full_chain.pem nginx:/etc/nginx/cert/ &amp;&amp; docker exec -it nginx service nginx force-reload"\n \n        Copied!\n    \n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[n("strong",[s._v("命令参数的含义")]),s._v(":")]),s._v(" "),n("ul",[n("li",[s._v("-d\n表示证书所属的域名")]),s._v(" "),n("li",[s._v("--key-file\n复制前面生成的 .key 文件到哪个位置。\n一般为 nginx 配置文件中 ssl_certificate_key 指定的路径。")]),s._v(" "),n("li",[s._v("--fullchain-file\n复制前面生成的 fullchain.cer 文件到哪个位置\n一般为 nginx 配置文件中 ssl_certificate 指定的路径。")]),s._v(" "),n("li",[s._v("--reloadcmd\n执行完证书文件的复制操作后，"),n("strong",[s._v("还需要执行哪些命令")]),s._v("才能将目标证书文件成功配置到 nginx 上。\n一般为 service nginx force-reload，强制重新加载配置文件即可启用最新的证书。\n该命令就很灵活了，甚至您可以在其它机器上完成证书的安装，然后再远程把证书文件同步到域名所在服务器上。")])]),s._v(" "),n("h3",{attrs:{id:"_3-2-配置nginx"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-配置nginx"}},[s._v("#")]),s._v(" 3.2 配置nginx")]),s._v(" "),n("p",[s._v("修改nginx配置文件，开启443端口, 配置证书路径。\n配置方法详见"),n("a",{attrs:{href:"https://www.sofineday.com/nginx-https.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("nginx配置https"),n("OutboundLink")],1),s._v("。 修改完成后，执行"),n("code",[s._v("service nginx force-reload")]),s._v("重新加载配置。\n那么，您的网站支持https访问了。")]),s._v(" "),n("h2",{attrs:{id:"_4-自动续期"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-自动续期"}},[s._v("#")]),s._v(" 4. 自动续期")]),s._v(" "),n("p",[s._v("acme.sh 已经自动安装了定时任务, 如下:")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('[root@iZ2ze7011et12xez70sp3dZ ~]# crontab -l\n10 0 * * * "/root/.acme.sh"/acme.sh --cron --home "/root/.acme.sh" > /dev/null\n[root@iZ2ze7011et12xez70sp3dZ ~]#\n \n        Copied!\n    \n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[s._v("该定时任务会每日定时检查 1 次，如果"),n("strong",[s._v("证书更新时间")]),s._v("已到，则会自动更新并安装证书。　　 可以通过"),n("strong",[s._v("acme.sh --list")]),s._v("命令查看证书的"),n("strong",[s._v("下次更新时间")]),s._v("(见 Renew 列)。")]),s._v(" "),n("blockquote",[n("p",[s._v("此处提到的"),n("strong",[s._v("证书更新时间")]),s._v("和"),n("strong",[s._v("证书到期时间")]),s._v("并非同一个概念，"),n("strong",[s._v("证书更新时间")]),s._v("指的是执行证书更新的时间，而"),n("strong",[s._v("证书到期时间")]),s._v("表示到了该时间后证书无效而导致无法通过 https 访问服务。")])]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('[root@iZ2ze7011et12xez70sp3dZ ~]# acme.sh --list\nMain_Domain    KeyLength  SAN_Domains      CA               Created                               Renew\nsofineday.com  ""         *.sofineday.com  LetsEncrypt.org  2020年 11月 03日 星期二 02:29:41 UTC  2021年 01月 02日 星期六 02:29:41 UTC\n[root@iZ2ze7011et12xez70sp3dZ ~]#\n \n        Copied!\n    \n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("我们先手工执行下定时任务的命令"),n("code",[s._v('"/root/.acme.sh"/acme.sh --cron --home "/root/.acme.sh"')]),s._v("，看下输出什么内容:")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("[root@iZ2ze7011et12xez70sp3dZ ~]# acme.sh --list\nMain_Domain    KeyLength  SAN_Domains      CA               Created                               Renew\nsofineday.com  \"\"         *.sofineday.com  LetsEncrypt.org  2020年 11月 03日 星期二 08:44:52 UTC  2021年 01月 02日 星期六 08:44:52 UTC\n[root@iZ2ze7011et12xez70sp3dZ ~]# \"/root/.acme.sh\"/acme.sh --cron --home \"/root/.acme.sh\"\n[2020年 11月 03日 星期二 17:20:16 CST] ===Starting cron===\n[2020年 11月 03日 星期二 17:20:16 CST] Please refer to https://curl.haxx.se/libcurl/c/libcurl-errors.html for error code: 7\n[2020年 11月 03日 星期二 17:20:16 CST] Please refer to https://curl.haxx.se/libcurl/c/libcurl-errors.html for error code: 7\n[2020年 11月 03日 星期二 17:20:16 CST] Installing from online archive.\n[2020年 11月 03日 星期二 17:20:16 CST] Downloading https://github.com/acmesh-official/acme.sh/archive/master.tar.gz\n[2020年 11月 03日 星期二 17:20:22 CST] Extracting master.tar.gz\n[2020年 11月 03日 星期二 17:20:23 CST] Installing to /root/.acme.sh\n[2020年 11月 03日 星期二 17:20:23 CST] Installed to /root/.acme.sh/acme.sh\n[2020年 11月 03日 星期二 17:20:23 CST] Good, bash is found, so change the shebang to use bash as preferred.\n[2020年 11月 03日 星期二 17:20:23 CST] OK\n[2020年 11月 03日 星期二 17:20:23 CST] Install success!\n[2020年 11月 03日 星期二 17:20:24 CST] Upgrade success!\n[2020年 11月 03日 星期二 17:20:24 CST] Auto upgraded to: 2.8.8\n[2020年 11月 03日 星期二 17:20:24 CST] Renew: 'mydomain.com'\n[2020年 11月 03日 星期二 17:20:24 CST] 'mydomain.com' is not an issued domain, skip.\n[2020年 11月 03日 星期二 17:20:24 CST] Skipped mydomain.com\n[2020年 11月 03日 星期二 17:20:24 CST] Renew: 'sofineday.com'\n[2020年 11月 03日 星期二 17:20:24 CST] Skip, Next renewal time is: 2021年 01月 02日 星期六 08:44:52 UTC\n[2020年 11月 03日 星期二 17:20:24 CST] Add '--force' to force to renew.\n[2020年 11月 03日 星期二 17:20:24 CST] Skipped sofineday.com\n[2020年 11月 03日 星期二 17:20:24 CST] ===End cron===\n[root@iZ2ze7011et12xez70sp3dZ ~]#\n \n        Copied!\n    \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br")])]),n("p",[s._v("可以看出，默认情况下，需要到了预定的时间 2021 年 01 月 02 日 星期六 08:44:52 UTC(见 Renew 列，默认为证书生成后的 60 天,也可以自定义，前文有描述), 才会自动更新证书。若想强制更新证书，则需要增加--force 参数，见下一节的内容"),n("a",{attrs:{href:"https://www.sofineday.com/nginx-https-auto-delay.html#5.-%E6%89%8B%E5%8A%A8%E6%9B%B4%E6%96%B0%E8%AF%81%E4%B9%A6",target:"_blank",rel:"noopener noreferrer"}},[s._v("手动更新证书"),n("OutboundLink")],1)]),s._v(" "),n("h2",{attrs:{id:"_5-手动更新证书"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-手动更新证书"}},[s._v("#")]),s._v(" 5. 手动更新证书")]),s._v(" "),n("p",[s._v("手动更新证书有多种方式:")]),s._v(" "),n("ul",[n("li",[s._v("通过 acme.sh 的 renew 指令")]),s._v(" "),n("li",[s._v("通过定时任务执行")])]),s._v(" "),n("h3",{attrs:{id:"_5-1-通过-acme-sh-的-renew-指令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-通过-acme-sh-的-renew-指令"}},[s._v("#")]),s._v(" 5.1 通过 acme.sh 的 renew 指令")]),s._v(" "),n("p",[s._v("通过 renew 指令会比第 2 种方式更灵活。可以单独更新某个证书，也可以更新所有证书。")]),s._v(" "),n("ul",[n("li",[s._v("单独更新某个证书\n"),n("code",[s._v("acme.sh --renew --domain sofineday.com")])])]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("[root@iZ2ze7011et12xez70sp3dZ ~]# acme.sh --renew --domain sofineday.com\n[2020年 11月 03日 星期二 18:01:38 CST] Renew: 'sofineday.com'\n[2020年 11月 03日 星期二 18:01:38 CST] Skip, Next renewal time is: 2021年 01月 02日 星期六 08:44:52 UTC\n[2020年 11月 03日 星期二 18:01:38 CST] Add '--force' to force to renew.\n[root@iZ2ze7011et12xez70sp3dZ ~]#\n \n        Copied!\n    \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("因为更新时间没有到，所以没有执行更新操作。若想强制更新，则追加--force 参数:\n"),n("code",[s._v("acme.sh --renew --domain sofineday.com --force")]),s._v("\n执行过程如下:")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("[2020 年 11 月 03 日 星期二 18:03:22 CST] Renew: 'sofineday.com'\n[2020 年 11 月 03 日 星期二 18:03:23 CST] Using CA: https://acme-v02.api.letsencrypt.org/directory\n[2020 年 11 月 03 日 星期二 18:03:23 CST] Multi domain='DNS:sofineday.com,DNS:_.sofineday.com'\n[2020 年 11 月 03 日 星期二 18:03:23 CST] Getting domain auth token for each domain\n[2020 年 11 月 03 日 星期二 18:03:30 CST] Getting webroot for domain='sofineday.com'\n[2020 年 11 月 03 日 星期二 18:03:30 CST] Getting webroot for domain='_.sofineday.com'\n[2020 年 11 月 03 日 星期二 18:03:31 CST] sofineday.com is already verified, skip dns-01.\n[2020 年 11 月 03 日 星期二 18:03:31 CST] _.sofineday.com is already verified, skip dns-01.\n[2020 年 11 月 03 日 星期二 18:03:31 CST] Verify finished, start to sign.\n[2020 年 11 月 03 日 星期二 18:03:31 CST] Lets finalize the order.\n[2020 年 11 月 03 日 星期二 18:03:31 CST] Le*OrderFinalize='https://acme-v02.api.letsencrypt.org/acme/finalize/101071293/6015050649'\n[2020 年 11 月 03 日 星期二 18:03:33 CST] Downloading cert.\n[2020 年 11 月 03 日 星期二 18:03:33 CST] Le_LinkCert='https://acme-v02.api.letsencrypt.org/acme/cert/046a3b81d368232ac6da38c1db0bd803fafc'\n[2020 年 11 月 03 日 星期二 18:03:34 CST] Cert success.\n-----BEGIN CERTIFICATE-----\nMIIFZDCCBEygAwIBAgISBGo7gdNoIyrG2jjB2wvYA/r8MA0GCSqGSIb3DQEBCwUA\nMEoxCzAJBgNVBAYTAlVTMRYwFAYDVQQKEw1MZXQncyBFbmNyeXB0MSMwIQYDVQQD\nExpMZXQncyBFbmNyeXB0IEF1dGhvcml0eSBYMzAeFw0yMDExMDMwOTAzMzNaFw0y\nMTAyMDEwOTAzMzNaMBgxFjAUBgNVBAMTDXNvZmluZWRheS5jb20wggEiMA0GCSqG\nSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDfAdIati/JZFCEMmTXD4j2UgOwKbKynjHk\nghcW0wA+YyNvIW/Y/kmN4fMk3qEslG6l/XXZ0Lv1IYYStRY70BlUUsHsJ/K/Mu0O\n+EFcCBOfggOoZ8J6RCP1tU/erTq2JJTiWNmlQSqCq92SyJJvVdYYOBRrlMuxtBba\n8pPLjcpxeSO4iEqlNJh+VJNJE1Loh3X77zRBkLwlsetcI/DwKEn670M01l61XMG1\nQMX8RRkp+O4J8Hy6SJlEFv1a320pZJ9IA5D3x8YpgvKJzb5043aN0gPBJ37MVtJq\nMw4NBh9gLk8JKNgbNgJPkJypggLXmGYiLLaFIZEPcoDtjF+xdQ+1AgMBAAGjggJ0\nMIICcDAOBgNVHQ8BAf8EBAMCBaAwHQYDVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUF\nBwMCMAwGA1UdEwEB/wQCMAAwHQYDVR0OBBYEFORKHDj/oRKs5nweoobwEffhV0T0\nMB8GA1UdIwQYMBaAFKhKamMEfd265tE5t6ZFZe/zqOyhMG8GCCsGAQUFBwEBBGMw\nYTAuBggrBgEFBQcwAYYiaHR0cDovL29jc3AuaW50LXgzLmxldHNlbmNyeXB0Lm9y\nZzAvBggrBgEFBQcwAoYjaHR0cDovL2NlcnQuaW50LXgzLmxldHNlbmNyeXB0Lm9y\nZy8wKQYDVR0RBCIwIIIPKi5zb2ZpbmVkYXkuY29tgg1zb2ZpbmVkYXkuY29tMEwG\nA1UdIARFMEMwCAYGZ4EMAQIBMDcGCysGAQQBgt8TAQEBMCgwJgYIKwYBBQUHAgEW\nGmh0dHA6Ly9jcHMubGV0c2VuY3J5cHQub3JnMIIBBQYKKwYBBAHWeQIEAgSB9gSB\n8wDxAHYA9lyUL9F3MCIUVBgIMJRWjuNNExkzv98MLyALzE7xZOMAAAF1jY/NuAAA\nBAMARzBFAiEAmaVBTxlQ47FYowMBQZyHKilgT46kA/Ud/YdHLV9zO3ECIBO2v0+T\nA4JWbub/BvJZXSOD84xXtiiZAMGz2LfP3bVhAHcAb1N2rDHwMRnYmQCkURX/dxUc\nEdkCwQApBo2yCJo32RMAAAF1jY/OEQAABAMASDBGAiEA3quHKHc/28EMK3KMTqZU\nxKPEgO4N0g3P+rR6qW8B7YMCIQCDq/146h+GYWrO52U6Ey3M4AfOLxf3IHDya9fl\njYV/ETANBgkqhkiG9w0BAQsFAAOCAQEAmNORzZu1BwiXup3TIzASl/odXVhsJF/I\nMXqMDSXR8cuafkralwCYy/ewh4vcgcZSfd0XCS/xPHDKZ5MeaKSh8enchH2WD6+G\nXyf8c4pWWdGKWqKxyPcX+5+hWvbzg/3SL7uDbBbhV9sRspGhQV4okEbYJvFLAydg\nuoYaDiMoHUrjgz9atLcHn6EgHelcv5JcJkVZR+qD2MmZwh5LFZFNkDhGJUOFAUbm\n1UDbGTUZt4CFx7ihZ7V9JJ69QQh+2Hub3SQJU3vHpB0pEKH7bBsfIomaWowQa3FQ\nj+3GSgudM1QR9EKUhENHTqJ+RXdGu2AFH22W1L25L1Eh0U27g89lZw==\n-----END CERTIFICATE-----\n[2020 年 11 月 03 日 星期二 18:03:34 CST] Your cert is in /root/.acme.sh/sofineday.com/sofineday.com.cer\n[2020 年 11 月 03 日 星期二 18:03:34 CST] Your cert key is in /root/.acme.sh/sofineday.com/sofineday.com.key\n[2020 年 11 月 03 日 星期二 18:03:34 CST] The intermediate CA cert is in /root/.acme.sh/sofineday.com/ca.cer\n[2020 年 11 月 03 日 星期二 18:03:34 CST] And the full chain certs is there: /root/.acme.sh/sofineday.com/fullchain.cer\n[2020 年 11 月 03 日 星期二 18:03:34 CST] Installing key to:/data/docker-service/nginx/cert/*.sofineday.com.private.key\n[2020 年 11 月 03 日 星期二 18:03:34 CST] Installing full chain to:/data/docker-service/nginx/cert/*.sofineday.com.full_chain.pem\n[2020 年 11 月 03 日 星期二 18:03:34 CST] Run reload cmd: docker cp /data/docker-service/nginx/cert/*.sofineday.com.private.key nginx:/etc/nginx/cert/ &amp;&amp; docker cp /data/docker-service/nginx/cert/\\_.sofineday.com.full_chain.pem nginx:/etc/nginx/cert/ &amp;&amp; docker exec -it nginx service nginx force-reload\n[ ok ] Reloading nginx: nginx.\n[2020 年 11 月 03 日 星期二 18:03:35 CST] Reload success\n[root@iZ2ze7011et12xez70sp3dZ ~]# acme.sh --list\nMain_Domain KeyLength SAN_Domains CA Created Renew\nsofineday.com \"\" _.sofineday.com LetsEncrypt.org 2020 年 11 月 03 日 星期二 10:03:34 UTC 2021 年 01 月 02 日 星期六 10:03:34 UTC\n[root@iZ2ze7011et12xez70sp3dZ ~]#\n\n \n        Copied!\n    \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br")])]),n("ul",[n("li",[s._v("更新所有证书 用法同"),n("strong",[s._v("单独更新某个证书")]),s._v("类似，只需将参数名改为--renew-all: "),n("code",[s._v("acme.sh --renew-all")]),s._v(" 强制更新: "),n("code",[s._v("acme.sh --renew-all --force")])])]),s._v(" "),n("h3",{attrs:{id:"_5-2-通过定时任务执行"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-通过定时任务执行"}},[s._v("#")]),s._v(" 5.2 通过定时任务执行")]),s._v(" "),n("p",[s._v("acme 内部维护着一个定时任务，到达指定时间(见 acme.sh --list 输出的 Renew 列)，则会更新证书。　　 若您想在证书过期之前，提前更新证书，则执行如下命令即可: acme.sh --cron --force")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("[root@iZ2ze7011et12xez70sp3dZ ~]# acme.sh --list\nMain*Domain KeyLength SAN_Domains CA Created Renew\nsofineday.com \"\" *.sofineday.com LetsEncrypt.org 2020 年 11 月 03 日 星期二 02:29:41 UTC 2021 年 01 月 02 日 星期六 02:29:41 UTC\n[root@iZ2ze7011et12xez70sp3dZ ~]# acme.sh --cron --force\n[2020 年 11 月 03 日 星期二 16:44:33 CST] ===Starting cron===\n[2020 年 11 月 03 日 星期二 16:44:33 CST] Installing from online archive.\n[2020 年 11 月 03 日 星期二 16:44:33 CST] Downloading https://github.com/acmesh-official/acme.sh/archive/master.tar.gz\n[2020 年 11 月 03 日 星期二 16:44:41 CST] Extracting master.tar.gz\n[2020 年 11 月 03 日 星期二 16:44:41 CST] Installing to /root/.acme.sh\n[2020 年 11 月 03 日 星期二 16:44:41 CST] Installed to /root/.acme.sh/acme.sh\n[2020 年 11 月 03 日 星期二 16:44:41 CST] Good, bash is found, so change the shebang to use bash as preferred.\n[2020 年 11 月 03 日 星期二 16:44:42 CST] OK\n[2020 年 11 月 03 日 星期二 16:44:42 CST] Install success!\n[2020 年 11 月 03 日 星期二 16:44:43 CST] Upgrade success!\n[2020 年 11 月 03 日 星期二 16:44:43 CST] Auto upgraded to: 2.8.8\n[2020 年 11 月 03 日 星期二 16:44:43 CST] Renew: 'mydomain.com'\n[2020 年 11 月 03 日 星期二 16:44:43 CST] 'mydomain.com' is not an issued domain, skip.\n[2020 年 11 月 03 日 星期二 16:44:43 CST] Skipped mydomain.com\n[2020 年 11 月 03 日 星期二 16:44:43 CST] Renew: 'sofineday.com'\n[2020 年 11 月 03 日 星期二 16:44:45 CST] Using CA: https://acme-v02.api.letsencrypt.org/directory\n[2020 年 11 月 03 日 星期二 16:44:45 CST] Multi domain='DNS:sofineday.com,DNS:_.sofineday.com'\n[2020 年 11 月 03 日 星期二 16:44:45 CST] Getting domain auth token for each domain\n[2020 年 11 月 03 日 星期二 16:44:49 CST] Getting webroot for domain='sofineday.com'\n[2020 年 11 月 03 日 星期二 16:44:49 CST] Getting webroot for domain='_.sofineday.com'\n[2020 年 11 月 03 日 星期二 16:44:49 CST] sofineday.com is already verified, skip dns-01.\n[2020 年 11 月 03 日 星期二 16:44:49 CST] _.sofineday.com is already verified, skip dns-01.\n[2020 年 11 月 03 日 星期二 16:44:49 CST] Verify finished, start to sign.\n[2020 年 11 月 03 日 星期二 16:44:49 CST] Lets finalize the order.\n[2020 年 11 月 03 日 星期二 16:44:49 CST] Le_OrderFinalize='https://acme-v02.api.letsencrypt.org/acme/finalize/101071293/6014120473'\n[2020 年 11 月 03 日 星期二 16:44:51 CST] Downloading cert.\n[2020 年 11 月 03 日 星期二 16:44:51 CST] Le_LinkCert='https://acme-v02.api.letsencrypt.org/acme/cert/0397895ff02c722b847007f4dbd979eda735'\n[2020 年 11 月 03 日 星期二 16:44:52 CST] Cert success.\n-----BEGIN CERTIFICATE-----\nMIIFYzCCBEugAwIBAgISA5eJX/AsciuEcAf029l57ac1MA0GCSqGSIb3DQEBCwUA\nMEoxCzAJBgNVBAYTAlVTMRYwFAYDVQQKEw1MZXQncyBFbmNyeXB0MSMwIQYDVQQD\nExpMZXQncyBFbmNyeXB0IEF1dGhvcml0eSBYMzAeFw0yMDExMDMwNzQ0NTBaFw0y\nMTAyMDEwNzQ0NTBaMBgxFjAUBgNVBAMTDXNvZmluZWRheS5jb20wggEiMA0GCSqG\nSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDfAdIati/JZFCEMmTXD4j2UgOwKbKynjHk\nghcW0wA+YyNvIW/Y/kmN4fMk3qEslG6l/XXZ0Lv1IYYStRY70BlUUsHsJ/K/Mu0O\n+EFcCBOfggOoZ8J6RCP1tU/erTq2JJTiWNmlQSqCq92SyJJvVdYYOBRrlMuxtBba\n8pPLjcpxeSO4iEqlNJh+VJNJE1Loh3X77zRBkLwlsetcI/DwKEn670M01l61XMG1\nQMX8RRkp+O4J8Hy6SJlEFv1a320pZJ9IA5D3x8YpgvKJzb5043aN0gPBJ37MVtJq\nMw4NBh9gLk8JKNgbNgJPkJypggLXmGYiLLaFIZEPcoDtjF+xdQ+1AgMBAAGjggJz\nMIICbzAOBgNVHQ8BAf8EBAMCBaAwHQYDVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUF\nBwMCMAwGA1UdEwEB/wQCMAAwHQYDVR0OBBYEFORKHDj/oRKs5nweoobwEffhV0T0\nMB8GA1UdIwQYMBaAFKhKamMEfd265tE5t6ZFZe/zqOyhMG8GCCsGAQUFBwEBBGMw\nYTAuBggrBgEFBQcwAYYiaHR0cDovL29jc3AuaW50LXgzLmxldHNlbmNyeXB0Lm9y\nZzAvBggrBgEFBQcwAoYjaHR0cDovL2NlcnQuaW50LXgzLmxldHNlbmNyeXB0Lm9y\nZy8wKQYDVR0RBCIwIIIPKi5zb2ZpbmVkYXkuY29tgg1zb2ZpbmVkYXkuY29tMEwG\nA1UdIARFMEMwCAYGZ4EMAQIBMDcGCysGAQQBgt8TAQEBMCgwJgYIKwYBBQUHAgEW\nGmh0dHA6Ly9jcHMubGV0c2VuY3J5cHQub3JnMIIBBAYKKwYBBAHWeQIEAgSB9QSB\n8gDwAHUAlCC8Ho7VjWyIcx+CiyIsDdHaTV5sT5Q9YdtOL1hNosIAAAF1jUe+ngAA\nBAMARjBEAiBmEQew/ZTGak523Jesy31aSBCy03TbSmOaEIS7C9ez9AIgRfaJXCtF\nG6WXDnpqsDu04MkWvBa7ykB+7TmYe2n9f34AdwB9PvL4j/+IVWgkwsDKnlKJeSvF\nDngJfy5ql2iZfiLw1wAAAXWNR77gAAAEAwBIMEYCIQCMo0BVA8eflzxz6xJsuUTe\nTG2LPIXqPB+TVPEDAZLBRQIhALcjTfd4i4evNxbWSzXg2X/0pYpho+RGmtW8tUR7\nedqUMA0GCSqGSIb3DQEBCwUAA4IBAQBKJRQMmLfgs+tyk4vP4k854OWYZzi4dzD9\nUO7bLIroQyS2V26mX7MNr35G5+KRpHtXOy5VYOePh1AgQSkJfi0v6efNlPVQ+Kub\niANsqQHcoDmnfPz9/iPIQ2O9ei1oD/Rkx0zBKXrzOlpf7vezreTFbXOuhbD5EwSc\nq+70BQ4LRU7+29MLStjlBp0NGZeiMh3MjtcNtnryK2d4zwzWQKuAY+gKHPYof5M1\n11d+5vYEFC/wfuZUMMcNhGeJcxr/nAn+0j+7ok9iirijkuhe5/vI2XOF/e9BYCch\nTK4w/d0Q7x7yW87NjqEly27nhpUqIhGYNUNWZ325MIvCr3GoDm/h\n-----END CERTIFICATE-----\n[2020 年 11 月 03 日 星期二 16:44:52 CST] Your cert is in /root/.acme.sh/sofineday.com/sofineday.com.cer\n[2020 年 11 月 03 日 星期二 16:44:52 CST] Your cert key is in /root/.acme.sh/sofineday.com/sofineday.com.key\n[2020 年 11 月 03 日 星期二 16:44:52 CST] The intermediate CA cert is in /root/.acme.sh/sofineday.com/ca.cer\n[2020 年 11 月 03 日 星期二 16:44:52 CST] And the full chain certs is there: /root/.acme.sh/sofineday.com/fullchain.cer\n[2020 年 11 月 03 日 星期二 16:44:52 CST] Installing key to:/data/docker-service/nginx/cert/_.sofineday.com.private.key\n[2020 年 11 月 03 日 星期二 16:44:52 CST] Installing full chain to:/data/docker-service/nginx/cert/_.sofineday.com.full_chain.pem\n[2020 年 11 月 03 日 星期二 16:44:52 CST] Run reload cmd: docker cp /data/docker-service/nginx/cert/_.sofineday.com.private.key nginx:/etc/nginx/cert/ &amp;&amp; docker cp /data/docker-service/nginx/cert/\\_.sofineday.com.full_chain.pem nginx:/etc/nginx/cert/ &amp;&amp; docker exec -it nginx service nginx force-reload\n[ ok ] Reloading nginx: nginx.\n[2020 年 11 月 03 日 星期二 16:44:53 CST] Reload success\n[2020 年 11 月 03 日 星期二 16:44:53 CST] ===End cron===\n[root@iZ2ze7011et12xez70sp3dZ ~]# acme.sh --list\nMain_Domain KeyLength SAN_Domains CA Created Renew\nsofineday.com \"\" \\*.sofineday.com LetsEncrypt.org 2020 年 11 月 03 日 星期二 08:44:52 UTC 2021 年 01 月 02 日 星期六 08:44:52 UTC\n[root@iZ2ze7011et12xez70sp3dZ ~]#\n\n \n        Copied!\n    \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br")])]),n("h2",{attrs:{id:"_6-查看证书列表"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-查看证书列表"}},[s._v("#")]),s._v(" 6. 查看证书列表")]),s._v(" "),n("p",[s._v("执行如下命令，查看证书列表 ~/.acme.sh/acme.sh --list")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('[root@iZ2ze7011et12xez70sp3dZ ~]# acme.sh --list\nMain_Domain KeyLength SAN_Domains CA Created Renew\nsofineday.com "" \\*.sofineday.com LetsEncrypt.org 2020 年 11 月 03 日 星期二 02:29:41 UTC 2021 年 01 月 02 日 星期六 02:29:41 UTC\n[root@iZ2ze7011et12xez70sp3dZ ~]#\n\n \n        Copied!\n    \n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("blockquote",[n("p",[s._v("Created 表示申请时间, Renew表示下次执行证书更新的时间。")])]),s._v(" "),n("h2",{attrs:{id:"_7-删除证书"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-删除证书"}},[s._v("#")]),s._v(" 7. 删除证书")]),s._v(" "),n("p",[s._v("acme.sh --remove --domain "),n("strong",[s._v("sofineday.com")])]),s._v(" "),n("blockquote",[n("p",[s._v("将域名换成实际域名即可")])]),s._v(" "),n("h2",{attrs:{id:"_8-更新-acme-sh"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-更新-acme-sh"}},[s._v("#")]),s._v(" 8. 更新 acme.sh")]),s._v(" "),n("p",[s._v("由于 acme 协议和 letsencrypt CA 都在频繁的更新, 因此 acme.sh 也经常更新以保持同步。 升级 acme.sh 到最新版：")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("acme.sh --upgrade\n\n \n        Copied!\n    \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("如果您不想手动升级,，可以开启自动升级：")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("acme.sh --upgrade --auto-upgrade\n\n \n        Copied!\n    \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("您也可以随时关闭自动更新：")]),s._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("acme.sh --upgrade --auto-upgrade 0\n\n \n        Copied!\n    \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h2",{attrs:{id:"_9-检测网站的安全级别"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_9-检测网站的安全级别"}},[s._v("#")]),s._v(" 9. 检测网站的安全级别")]),s._v(" "),n("p",[s._v("可以使用如下网站检测网站的安全级别:")]),s._v(" "),n("ul",[n("li",[s._v("https://myssl.com")])]),s._v(" "),n("h2",{attrs:{id:"_10-其它资料"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_10-其它资料"}},[s._v("#")]),s._v(" 10. 其它资料")]),s._v(" "),n("h3",{attrs:{id:"freessl-cn官方提供的证书自动续期方案"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#freessl-cn官方提供的证书自动续期方案"}},[s._v("#")]),s._v(" freessl.cn官方提供的证书自动续期方案")]),s._v(" "),n("p",[s._v("发现freessl.cn总结了一套”支持https证书自动续期“的文档，但经过我的实际操作发现，生成证书时一直失败并最终退出(尝试过多次)。所以并没有见得比我之前总结的方法好。但是可以作为拓展资料，见"),n("a",{attrs:{href:"https://blog.freessl.cn/acme-quick-start/",target:"_blank",rel:"noopener noreferrer"}},[s._v("ACME v2证书自动化快速入门 (opens new window)"),n("OutboundLink")],1),s._v("。\n该套方案实际上是使用freessl.cn创建的CA服务器来生成证书。")]),s._v(" "),n("p",[s._v("操作步骤：")]),s._v(" "),n("ol",[n("li",[s._v("访问https://freessl.cn")]),s._v(" "),n("li",[s._v("输入域名")]),s._v(" "),n("li",[s._v("选择带有"),n("code",[s._v("多域名通配符(有效期：自动续期)")]),s._v("标志的亚洲诚信厂商")]),s._v(" "),n("li",[s._v("点击"),n("code",[s._v("创建免费的ssl证书")])]),s._v(" "),n("li",[s._v("按提示操作即可")])])])}),[],!1,null,null,null);n.default=t.exports}}]);