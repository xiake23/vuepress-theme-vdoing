(window.webpackJsonp=window.webpackJsonp||[]).push([[80],{408:function(a,s,t){"use strict";t.r(s);var e=t(4),r=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"docker-数据管理-备份和恢复指南"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-数据管理-备份和恢复指南"}},[a._v("#")]),a._v(" Docker 数据管理：备份和恢复指南")]),a._v(" "),s("h2",{attrs:{id:"_0x00-引言"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_0x00-引言"}},[a._v("#")]),a._v(" 0x00 引言")]),a._v(" "),s("p",[a._v("在 Docker 环境中，数据管理是一个重要问题。不同的部署方式会导致数据存储在不同的位置，这直接影响了备份和恢复策略。本指南将详细介绍如何根据不同的部署方式和数据存储位置来制定相应的 Docker 数据备份和恢复方案。关于 Docker 中不同的数据存储方式的详细说明，请参阅《Docker 数据管理：卷和绑定挂载指南》["),s("a",{attrs:{href:"https://linux.do/t/topic/174250#p-1391720-h-15",target:"_blank",rel:"noopener noreferrer"}},[a._v("1]"),s("OutboundLink")],1),a._v("。")]),a._v(" "),s("h2",{attrs:{id:"_0x01-数据存储方式回顾"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_0x01-数据存储方式回顾"}},[a._v("#")]),a._v(" 0x01 数据存储方式回顾")]),a._v(" "),s("p",[a._v("在深入讨论备份和恢复之前，让我们先回顾一下 Docker 中的主要数据存储方式：")]),a._v(" "),s("ol",[s("li",[a._v("容器内存储：数据存储在容器的文件系统中。")]),a._v(" "),s("li",[a._v("卷（Volumes）：Docker 管理的持久化存储，通常位于 "),s("code",[a._v("/var/lib/docker/volumes/")]),a._v("。")]),a._v(" "),s("li",[a._v("绑定挂载（Bind Mounts）：将主机上的目录或文件挂载到容器中。")])]),a._v(" "),s("p",[a._v("了解这些存储方式对于制定正确的备份策略至关重要。")]),a._v(" "),s("h2",{attrs:{id:"_0x02-常见部署方式及数据存储"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_0x02-常见部署方式及数据存储"}},[a._v("#")]),a._v(" 0x02 常见部署方式及数据存储")]),a._v(" "),s("h3",{attrs:{id:"_0x02-使用-docker-run-命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_0x02-使用-docker-run-命令"}},[a._v("#")]),a._v(" 0x02 使用 docker run 命令")]),a._v(" "),s("h4",{attrs:{id:"_0x02-无卷挂载"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_0x02-无卷挂载"}},[a._v("#")]),a._v(" 0x02 无卷挂载")]),a._v(" "),s("p",[a._v("示例命令：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" myapp "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8080")]),a._v(":80 nginx\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("这种情况下，数据存储在容器内部。容器被删除后，数据将丢失。")]),a._v(" "),s("p",[a._v("备份方法：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" myapp:/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("data_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" /"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("backup_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("blockquote",[s("p",[a._v("注意：")]),a._v(" "),s("ul",[s("li",[s("code",[a._v("{data_path}")]),a._v(" 是容器内应用的默认数据存储路径。每个应用都有其特定的默认路径，可以查阅应用的官方文档获取详细信息。")]),a._v(" "),s("li",[s("code",[a._v("{backup_path}")]),a._v(" 是主机上用于存储备份的目录路径。")]),a._v(" "),s("li",[a._v("如果一个 docker 应用需要持久化数据，开发者一般不会提供无卷/绑定挂载 "),s("code",[a._v("docker run")]),a._v(" 命令。")])])]),a._v(" "),s("p",[a._v("恢复方法：")]),a._v(" "),s("ol",[s("li",[a._v("创建新容器")]),a._v(" "),s("li",[a._v("将备份数据复制到新容器:")])]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" /"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("backup_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" myapp:/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("data_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h4",{attrs:{id:"_0x02-使用卷挂载"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_0x02-使用卷挂载"}},[a._v("#")]),a._v(" 0x02 使用卷挂载")]),a._v(" "),s("p",[a._v("示例命令:")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" myapp "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" myapp_data:/container/data "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8080")]),a._v(":80 nginx\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("在这种情况下，数据存储在 Docker 管理的卷中。")]),a._v(" "),s("p",[a._v("备份方法：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--rm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" myapp_data:/source "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("host_backup_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(":/backup busybox "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" cvf /backup/backup.tar /source\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("details",{staticStyle:{display:"block",outline:"none","background-color":"var(--primary-very-low)",padding:"0.25rem 0.75rem","margin-bottom":"0.5rem",color:"rgb(221, 221, 221)","font-family":"Arial, sans-serif","font-size":"16px","font-style":"normal","font-variant-ligatures":"normal","font-variant-caps":"normal","font-weight":"400","letter-spacing":"normal",orphans:"2","text-align":"start","text-indent":"0px","text-transform":"none",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","white-space":"normal","text-decoration-thickness":"initial","text-decoration-style":"initial","text-decoration-color":"initial"},attrs:{dir:"auto"}},[s("summary",{staticStyle:{display:"block",outline:"none",cursor:"pointer"}},[s("span",[a._v(" ")]),a._v("这个命令的工作原理如下")])]),a._v(" "),s("blockquote",[s("p",[s("strong",[a._v("数据流向")]),a._v("：")]),a._v(" "),s("p",[a._v("Docker 数据卷 → 临时容器的 "),s("code",[a._v("/source")]),a._v(" 目录 → tar 文件 → 临时容器的 "),s("code",[a._v("/backup")]),a._v(" 目录 → 主机上的 "),s("code",[a._v("/{host_backup_path}")])]),a._v(" "),s("p",[a._v("注意："),s("code",[a._v("{host_backup_path}")]),a._v(" 是主机上用于存储备份的目录路径。")])]),a._v(" "),s("p",[a._v("恢复方法：")]),a._v(" "),s("ol",[s("li",[s("p",[a._v("创建新的数据卷（如果需要）：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" volume create new_myapp_data\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])])]),a._v(" "),s("li",[s("p",[a._v("恢复数据:")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--rm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" new_myapp_data:/target "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("host_backup_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(":/backup busybox "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" xvf /backup/backup.tar "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-C")]),a._v(" /target --strip-components"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])])])]),a._v(" "),s("details",{staticStyle:{display:"block",outline:"none","background-color":"var(--primary-very-low)",padding:"0.25rem 0.75rem","margin-bottom":"0.5rem",color:"rgb(221, 221, 221)","font-family":"Arial, sans-serif","font-size":"16px","font-style":"normal","font-variant-ligatures":"normal","font-variant-caps":"normal","font-weight":"400","letter-spacing":"normal",orphans:"2","text-align":"start","text-indent":"0px","text-transform":"none",widows:"2","word-spacing":"0px","-webkit-text-stroke-width":"0px","white-space":"normal","text-decoration-thickness":"initial","text-decoration-style":"initial","text-decoration-color":"initial"},attrs:{dir:"auto"}},[s("summary",{staticStyle:{display:"block",outline:"none",cursor:"pointer"}},[s("span",[a._v(" ")]),a._v("这个命令的工作原理如下")])]),a._v(" "),s("blockquote",[s("p",[s("strong",[a._v("数据流向")]),a._v("：")]),a._v(" "),s("p",[a._v("主机上的 "),s("code",[a._v("/{host_backup_path}")]),a._v(" → 临时容器的 "),s("code",[a._v("/backup")]),a._v(" 目录 → tar 文件解压 → 临时容器的 "),s("code",[a._v("/target")]),a._v(" 目录 → 新的 Docker 数据卷")])]),a._v(" "),s("h4",{attrs:{id:"_0x02-使用绑定挂载"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_0x02-使用绑定挂载"}},[a._v("#")]),a._v(" 0x02 使用绑定挂载")]),a._v(" "),s("p",[a._v("示例命令:")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" myapp "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("host_data_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(":/container/data "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8080")]),a._v(":80 nginx\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("在这种情况下，数据直接存储在主机文件系统上。")]),a._v(" "),s("p",[a._v("备份方法：直接备份主机上的 "),s("code",[a._v("/{host_data_path}")]),a._v(" 目录。")]),a._v(" "),s("p",[a._v("恢复方法：")]),a._v(" "),s("ol",[s("li",[a._v("创建新容器，使用相同的绑定挂载")]),a._v(" "),s("li",[a._v("将备份数据复制到主机的 "),s("code",[a._v("/{host_data_path}")]),a._v(" 目录")])]),a._v(" "),s("blockquote",[s("p",[a._v("注意："),s("code",[a._v("{host_data_path}")]),a._v(" 是主机上用于存储数据的目录路径。")])]),a._v(" "),s("h3",{attrs:{id:"_0x02-使用-dockerfile"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_0x02-使用-dockerfile"}},[a._v("#")]),a._v(" 0x02 使用 Dockerfile")]),a._v(" "),s("h4",{attrs:{id:"_0x02-在-dockerfile-中定义-volume"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_0x02-在-dockerfile-中定义-volume"}},[a._v("#")]),a._v(" 0x02 在 Dockerfile 中定义 VOLUME")]),a._v(" "),s("p",[s("code",[a._v("Dockerfile")]),a._v(" 示例：")]),a._v(" "),s("div",{staticClass:"language-dockerfile line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[s("code",[s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("FROM")]),a._v(" nginx")]),a._v("\n...\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("VOLUME")]),a._v(" /app/data")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("p",[a._v("这种情况下，Docker 会在主机上创建一个匿名卷。")]),a._v(" "),s("p",[a._v("备份方法：")]),a._v(" "),s("ol",[s("li",[s("p",[a._v("找到卷的挂载点：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" inspect "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'{{ (index .Mounts 0).Source }}'")]),a._v(" myapp\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])])]),a._v(" "),s("li",[s("p",[a._v("备份该目录内容。")])])]),a._v(" "),s("p",[a._v("恢复方法：")]),a._v(" "),s("ol",[s("li",[a._v("创建新容器")]),a._v(" "),s("li",[a._v("使用 "),s("code",[a._v("docker cp")]),a._v(" 命令将备份数据复制到新容器的相应目录")])]),a._v(" "),s("h4",{attrs:{id:"_0x02-在-dockerfile-中使用-copy-或-add-命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_0x02-在-dockerfile-中使用-copy-或-add-命令"}},[a._v("#")]),a._v(" 0x02 在 Dockerfile 中使用 COPY 或 ADD 命令")]),a._v(" "),s("p",[s("code",[a._v("Dockerfile")]),a._v(" 示例:")]),a._v(" "),s("div",{staticClass:"language-dockerfile line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[s("code",[s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("FROM")]),a._v(" nginx")]),a._v("\n...\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("COPY")]),a._v(" ./myapp /app")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("p",[a._v("这种情况下，数据会被复制到容器的文件系统中。")]),a._v(" "),s("p",[a._v("备份方法:")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" commit myapp_instance myapp_backup\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" save myapp_backup "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" myapp_backup.tar\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("blockquote",[s("p",[s("code",[a._v("docker commit")]),a._v(" 命令创建当前容器状态的新镜像。这会捕获容器中的所有更改，包括通过 COPY 或 ADD 命令添加的文件以及运行时的修改。")]),a._v(" "),s("p",[s("code",[a._v("docker save")]),a._v(" 命令将镜像保存为一个 tar 文件，可以用于传输或存档。")]),a._v(" "),s("p",[a._v("注意：这种方法会创建整个容器的完整快照。可能会导致备份文件较大。对于只需要备份特定数据的情况，考虑使用数据卷或绑定挂载可能更合适。")])]),a._v(" "),s("p",[a._v("恢复方法：")]),a._v(" "),s("ol",[s("li",[a._v("加载备份的镜像:")])]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" load "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v(" myapp_backup.tar\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("ol",[s("li",[a._v("从加载的镜像创建新容器:")])]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" myapp_restored myapp_backup\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h2",{attrs:{id:"_0x03-使用-docker-compose-管理容器和卷"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_0x03-使用-docker-compose-管理容器和卷"}},[a._v("#")]),a._v(" 0x03 使用 docker-compose 管理容器和卷")]),a._v(" "),s("p",[a._v("创建 "),s("code",[a._v("docker-compose.yml")]),a._v(" 文件:")]),a._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'3'")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("myapp")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nginx\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" myapp_data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("/app/data\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" ./config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("/app/config\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("myapp_data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br")])]),s("p",[a._v("在这个例子中，我们同时使用了命名卷（"),s("code",[a._v("myapp_data")]),a._v("）和绑定挂载（"),s("code",[a._v("./config")]),a._v("）。关于如何在 docker-compose 中使用卷和绑定挂载的更多信息，请参考"),s("a",{attrs:{href:"https://linux.do/t/topic/174427",target:"_blank",rel:"noopener noreferrer"}},[a._v("卷和绑定挂载指南 6"),s("OutboundLink")],1),a._v("。")]),a._v(" "),s("p",[a._v("备份方法：")]),a._v(" "),s("p",[a._v("对于命名卷：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--rm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" myapp_data:/source "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("host_backup_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(":/backup busybox "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" cvf /backup/volume_backup.tar /source\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("对于绑定挂载：直接备份主机上的 "),s("code",[a._v("./config")]),a._v(" 目录。")]),a._v(" "),s("p",[a._v("恢复方法：")]),a._v(" "),s("ol",[s("li",[s("p",[a._v("停止服务："),s("code",[a._v("docker-compose down")])])]),a._v(" "),s("li",[s("p",[a._v("对于命名卷：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--rm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" myapp_data:/target "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" /"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("host_backup_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(":/backup busybox "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" xvf /backup/volume_backup.tar "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-C")]),a._v(" /target --strip-components"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])])]),a._v(" "),s("li",[s("p",[a._v("对于绑定挂载：将备份数据复制回 "),s("code",[a._v("./config")]),a._v(" 目录")])]),a._v(" "),s("li",[s("p",[a._v("启动服务："),s("code",[a._v("docker-compose up -d")])])])]),a._v(" "),s("blockquote",[s("p",[a._v("注意："),s("code",[a._v("{host_backup_path}")]),a._v(" 是主机上用于存储备份的目录路径。")])]),a._v(" "),s("h2",{attrs:{id:"_0x04-最佳实践"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_0x04-最佳实践"}},[a._v("#")]),a._v(" 0x04 最佳实践")]),a._v(" "),s("ol",[s("li",[s("p",[a._v("使用 docker-compose：它提供了一种简单、可重复的方式来管理多容器应用及其数据卷。")])]),a._v(" "),s("li",[s("p",[a._v("优先使用命名卷：命名卷比匿名卷更易于管理和备份。")])]),a._v(" "),s("li",[s("p",[a._v("使用数据卷备份脚本：创建一个 shell 脚本来自动化备份过程。例如：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token shebang important"}},[a._v("#!/bin/bash")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("VOLUME_NAME")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"myapp_data"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("BACKUP_DIR")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/{host_backup_path}"')]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("TIMESTAMP")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("date")]),a._v(" +"),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"%Y%m%d_%H%M%S"')]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--rm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$VOLUME_NAME")]),a._v(":/source "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$BACKUP_DIR")]),a._v(":/backup "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n  busybox "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" cvf /backup/"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${VOLUME_NAME}")]),a._v("_"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("${TIMESTAMP}")]),a._v(".tar /source\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br")])])]),a._v(" "),s("li",[s("p",[a._v("实施定期备份：使用 "),s("code",[a._v("cron")]),a._v(" 作业定期运行备份脚本。")])]),a._v(" "),s("li",[s("p",[a._v("如果容器较多，编排复杂，考虑使用 "),s("code",[a._v("Docker Swarm")]),a._v(" 或 "),s("code",[a._v("Kubernetes")]),a._v("：k8s，swarm 可以提供更强大的编排和数据管理功能。")])])]),a._v(" "),s("h2",{attrs:{id:"_0x05-结语"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_0x05-结语"}},[a._v("#")]),a._v(" 0x05 结语")]),a._v(" "),s("p",[a._v("在 Docker 的世界里，没有什么问题是一个好的持久化策略解决不了的。如果有，那就再加一个数据卷！")]),a._v(" "),s("p",[a._v("记住，了解数据的存储位置是制定有效备份策略的关键。通过选择合适的数据管理方式和实施定期备份，可以显著降低数据丢失的风险。毕竟，在数据的海洋中，备份就是你的救生圈！")]),a._v(" "),s("h2",{attrs:{id:"参考文献"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考文献"}},[a._v("#")]),a._v(" 参考文献")]),a._v(" "),s("p",[a._v("[1] "),s("a",{attrs:{href:"https://linux.do/t/topic/174427",target:"_blank",rel:"noopener noreferrer"}},[a._v("Docker 数据管理：卷和绑定挂载指南 6"),s("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=r.exports}}]);